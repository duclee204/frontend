import { Component, EventEmitter, Input, Output } from '@angular/core';
import { BaseControl } from '../../public-api';
import { CommonUtils } from '../../services/common-utils.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "primeng/api";
import * as i3 from "@angular/common";
import * as i4 from "primeng/calendar";
import * as i5 from "../control-messages/control-messages.component";
export class DatePickerComponent {
    constructor(controlContainer, primengConfig) {
        this.controlContainer = controlContainer;
        this.primengConfig = primengConfig;
        // formControl of this input
        this.property = new BaseControl();
        this.dateFormat = 'dd/mm/yy';
        this.onChanged = new EventEmitter();
        this.dateValue = null;
        this.oldPos = 0;
        this.dateMask = '';
        // TODO
        this.primengConfig.setTranslation({
            dayNames: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
            dayNamesShort: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
            dayNamesMin: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
            monthNames: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
            monthNamesShort: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
            today: 'Hôm nay',
            clear: 'Làm mới'
        });
    }
    ngOnChanges() {
        if (this.property.value) {
            this.dateValue = new Date(this.property.value);
        }
        else {
            this.dateValue = null;
        }
    }
    onBlur(event) {
        if (!this.dateValue && event.currentTarget.value !== '') {
            // this.helperService.APP_TOAST_MESSAGE.next({ type: 'ERROR', code: 'dateInvalid', message: null });
        }
        // Xu ly neu nguoi dung xoa het gia tri ngay thang
        if (event.currentTarget.value === '' && this.dateValue !== null) {
            this.dateValue = null;
            this.onInput(null);
        }
        if (event.currentTarget.value === '' && this.dateValue == null) {
            this.onChanged.emit(event);
        }
    }
    onInput(event) {
        let parseFormat = this.initDateFormatPosition(CommonUtils.getDateFormat());
        if (this.dateFormat == 'mm/yy') {
            parseFormat = this.initDateFormatPosition('MM/yyyy');
        }
        if (event) {
            let cursorPosition = event.target.selectionEnd;
            // if (event.inputType === 'deleteContentBackward' && parseFormat.isBackward(cursorPosition)) {
            //   event.target.value = event.target.value.substring(0, cursorPosition - 1) + event.target.value.substring(cursorPosition);
            //   cursorPosition --;
            // }
            // if (event.inputType === 'insertText' && (event.target.value.length > parseFormat.maxLength)) {
            //     event.target.value = event.target.value.substring(0, event.target.value.length - 1);
            // }
            if (this.oldPos > cursorPosition && parseFormat.isBackward(cursorPosition)) {
                event.target.value = event.target.value.substring(0, cursorPosition - 1) + event.target.value.substring(cursorPosition);
                cursorPosition--;
            }
            if (this.oldPos < cursorPosition && (event.target.value.length > parseFormat.maxLength)) {
                event.target.value = event.target.value.substring(0, event.target.value.length - 1);
            }
            this.oldPos = event.target.selectionEnd;
            this.dateMask = event.target.value.toString();
            this.dateMask = this.dateMask?.replace(/\D/g, '');
            let mask = '';
            for (let i = 0; i < this.dateMask.length; i++) {
                mask += this.dateMask[i];
                if (parseFormat.isForward(i)) {
                    mask += '/';
                    if (parseFormat.isBackward(cursorPosition)) {
                        cursorPosition++;
                        this.oldPos++;
                    }
                }
            }
            event.target.value = mask.toString();
            event.target.selectionStart = cursorPosition;
            event.target.selectionEnd = cursorPosition;
        }
        if (this.dateValue) {
            this.property.setValue(this.dateValue.getTime());
        }
        else {
            this.property.setValue(null);
        }
        if (this.onChange) {
            this.onChange();
        }
    }
    initDateFormatPosition(dateFormat) {
        const maxLength = dateFormat.length;
        const iMask = [];
        for (let i = 0; i < dateFormat.length; i++) {
            const char = dateFormat[i];
            if ('/' === char) {
                iMask.push(i - iMask.length > 0 ? (i - iMask.length - 1) : (i - iMask.length));
            }
        }
        const parse = {
            maxLength: maxLength,
            isBackward: (cursorPosition) => {
                const char = dateFormat.substr(cursorPosition, 1);
                return char === '/';
            }, isForward: (i) => {
                return iMask.indexOf(i) >= 0;
            }
        };
        return parse;
    }
    onSelect(event) {
        if (this.dateValue) {
            this.property.setValue(this.dateValue.getTime());
        }
        else {
            this.property.setValue(null);
        }
        if (this.onChange) {
            this.onChange();
        }
        this.onChanged.emit(event);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: DatePickerComponent, deps: [{ token: i1.ControlContainer }, { token: i2.PrimeNGConfig }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.5", type: DatePickerComponent, selector: "app-date-picker", inputs: { property: "property", labelValue: "labelValue", dateFormat: "dateFormat", onChange: "onChange" }, outputs: { onChanged: "onChanged" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"field\">\n    <label class=\"font-semibold\" [ngClass]=\"{'required': property.isRequire}\">{{ labelValue }}</label>\n    <p-calendar [(ngModel)]=\"dateValue\" [showIcon]=\"true\"\n        [dateFormat]=\"dateFormat\"\n        class=\"w-full inline-block\"\n        appendTo=\"body\"\n        (onInput)=\"onInput($event)\"\n        (onSelect)=\"onSelect($event)\"\n        (onBlur)=\"onBlur($event)\"></p-calendar>\n    <app-control-messages [control]=\"property\"></app-control-messages>\n</div>\n", styles: ["::ng-deep app-date-picker span.p-calendar{width:100%}::ng-deep app-date-picker span.p-calendar input{height:40px}\n"], dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i4.Calendar, selector: "p-calendar", inputs: ["style", "styleClass", "inputStyle", "inputId", "name", "inputStyleClass", "placeholder", "ariaLabelledBy", "iconAriaLabel", "disabled", "dateFormat", "multipleSeparator", "rangeSeparator", "inline", "showOtherMonths", "selectOtherMonths", "showIcon", "icon", "appendTo", "readonlyInput", "shortYearCutoff", "monthNavigator", "yearNavigator", "hourFormat", "timeOnly", "stepHour", "stepMinute", "stepSecond", "showSeconds", "required", "showOnFocus", "showWeek", "showClear", "dataType", "selectionMode", "maxDateCount", "showButtonBar", "todayButtonStyleClass", "clearButtonStyleClass", "autoZIndex", "baseZIndex", "panelStyleClass", "panelStyle", "keepInvalid", "hideOnDateTimeSelect", "touchUI", "timeSeparator", "focusTrap", "showTransitionOptions", "hideTransitionOptions", "tabindex", "minDate", "maxDate", "disabledDates", "disabledDays", "yearRange", "showTime", "responsiveOptions", "numberOfMonths", "firstDayOfWeek", "locale", "view", "defaultDate"], outputs: ["onFocus", "onBlur", "onClose", "onSelect", "onClear", "onInput", "onTodayClick", "onClearClick", "onMonthChange", "onYearChange", "onClickOutside", "onShow"] }, { kind: "component", type: i5.ControlMessagesComponent, selector: "app-control-messages", inputs: ["control", "labelName"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: DatePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-date-picker', template: "<div class=\"field\">\n    <label class=\"font-semibold\" [ngClass]=\"{'required': property.isRequire}\">{{ labelValue }}</label>\n    <p-calendar [(ngModel)]=\"dateValue\" [showIcon]=\"true\"\n        [dateFormat]=\"dateFormat\"\n        class=\"w-full inline-block\"\n        appendTo=\"body\"\n        (onInput)=\"onInput($event)\"\n        (onSelect)=\"onSelect($event)\"\n        (onBlur)=\"onBlur($event)\"></p-calendar>\n    <app-control-messages [control]=\"property\"></app-control-messages>\n</div>\n", styles: ["::ng-deep app-date-picker span.p-calendar{width:100%}::ng-deep app-date-picker span.p-calendar input{height:40px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer }, { type: i2.PrimeNGConfig }]; }, propDecorators: { property: [{
                type: Input
            }], labelValue: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], onChange: [{
                type: Input
            }], onChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW5ndWxhcngtc2NvcmUvc3JjL2xpYi9zaGFyZWQvY29tcG9uZW50cy9kYXRlLXBpY2tlci9kYXRlLXBpY2tlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyeC1zY29yZS9zcmMvbGliL3NoYXJlZC9jb21wb25lbnRzL2RhdGUtcGlja2VyL2RhdGUtcGlja2VyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQzs7Ozs7OztBQVNsRSxNQUFNLE9BQU8sbUJBQW1CO0lBcUI5QixZQUNVLGdCQUFrQyxFQUNsQyxhQUE0QjtRQUQ1QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBdEJ0Qyw0QkFBNEI7UUFFckIsYUFBUSxHQUFnQixJQUFJLFdBQVcsRUFBRSxDQUFDO1FBTTFDLGVBQVUsR0FBVyxVQUFVLENBQUM7UUFNaEMsY0FBUyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXZELGNBQVMsR0FBUSxJQUFJLENBQUM7UUFDckIsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLGFBQVEsR0FBVyxFQUFFLENBQUM7UUFNNUIsT0FBTztRQUNQLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDO1lBQ2hDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVB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LGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDbEQsT0FBTyxJQUFJLEtBQUssR0FBRyxDQUFDO1lBQ3RCLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFNLEVBQUUsRUFBRTtnQkFDdkIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvQixDQUFDO1NBQ0YsQ0FBQztRQUNGLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUFVO1FBQ2pCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDbEQ7YUFBTTtZQUNMLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzlCO1FBQ0QsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNqQjtRQUNELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7OEdBakpVLG1CQUFtQjtrR0FBbkIsbUJBQW1CLDZOQ1hoQyxnZ0JBV0E7OzJGREFhLG1CQUFtQjtrQkFML0IsU0FBUzsrQkFDRSxpQkFBaUI7bUlBT3BCLFFBQVE7c0JBRGQsS0FBSztnQkFJQyxVQUFVO3NCQURoQixLQUFLO2dCQUlDLFVBQVU7c0JBRGhCLEtBQUs7Z0JBSUMsUUFBUTtzQkFEZCxLQUFLO2dCQUlDLFNBQVM7c0JBRGYsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQmFzZUNvbnRyb2wgfSBmcm9tICcuLi8uLi9wdWJsaWMtYXBpJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb21tb24tdXRpbHMuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xDb250YWluZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFByaW1lTkdDb25maWcgfSBmcm9tICdwcmltZW5nL2FwaSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1kYXRlLXBpY2tlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGUtcGlja2VyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9kYXRlLXBpY2tlci5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcclxuICAvLyBmb3JtQ29udHJvbCBvZiB0aGlzIGlucHV0XHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgcHJvcGVydHk6IEJhc2VDb250cm9sID0gbmV3IEJhc2VDb250cm9sKCk7XHJcbiAgLy8gdGl0bGUgZm9yIGxhYmxlXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgbGFiZWxWYWx1ZSE6IHN0cmluZztcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgZGF0ZUZvcm1hdDogc3RyaW5nID0gJ2RkL21tL3l5JztcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgb25DaGFuZ2U6IEZ1bmN0aW9uIHwgdW5kZWZpbmVkO1xyXG4gIFxyXG4gIEBPdXRwdXQoKVxyXG4gIHB1YmxpYyBvbkNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIHB1YmxpYyBkYXRlVmFsdWU6IGFueSA9IG51bGw7XHJcbiAgcHJpdmF0ZSBvbGRQb3MgPSAwO1xyXG4gIHByaXZhdGUgZGF0ZU1hc2s6IHN0cmluZyA9ICcnO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgY29udHJvbENvbnRhaW5lcjogQ29udHJvbENvbnRhaW5lcixcclxuICAgIHByaXZhdGUgcHJpbWVuZ0NvbmZpZzogUHJpbWVOR0NvbmZpZ1xyXG4gICkge1xyXG4gICAgLy8gVE9ET1xyXG4gICAgdGhpcy5wcmltZW5nQ29uZmlnLnNldFRyYW5zbGF0aW9uKHtcclxuICAgICAgZGF5TmFtZXM6IFsnQ04nLCAnVDInLCAnVDMnLCAnVDQnLCAnVDUnLCAnVDYnLCAnVDcnXSxcclxuICAgICAgZGF5TmFtZXNTaG9ydDogWydDTicsICdUMicsICdUMycsICdUNCcsICdUNScsICdUNicsICdUNyddLFxyXG4gICAgICBkYXlOYW1lc01pbjogWydDTicsICdUMicsICdUMycsICdUNCcsICdUNScsICdUNicsICdUNyddLFxyXG4gICAgICBtb250aE5hbWVzOiBbJ1Row6FuZyAxJywgJ1Row6FuZyAyJywgJ1Row6FuZyAzJywgJ1Row6FuZyA0JywgJ1Row6FuZyA1JywgJ1Row6FuZyA2JywgJ1Row6FuZyA3JywgJ1Row6FuZyA4JywgJ1Row6FuZyA5JywgJ1Row6FuZyAxMCcsICdUaMOhbmcgMTEnLCAnVGjDoW5nIDEyJ10sXHJcbiAgICAgIG1vbnRoTmFtZXNTaG9ydDogWydUaMOhbmcgMScsICdUaMOhbmcgMicsICdUaMOhbmcgMycsICdUaMOhbmcgNCcsICdUaMOhbmcgNScsICdUaMOhbmcgNicsICdUaMOhbmcgNycsICdUaMOhbmcgOCcsICdUaMOhbmcgOScsICdUaMOhbmcgMTAnLCAnVGjDoW5nIDExJywgJ1Row6FuZyAxMiddLFxyXG4gICAgICB0b2RheTogJ0jDtG0gbmF5JyxcclxuICAgICAgY2xlYXI6ICdMw6BtIG3hu5tpJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcygpIHtcclxuICAgIGlmICh0aGlzLnByb3BlcnR5LnZhbHVlKSB7XHJcbiAgICAgIHRoaXMuZGF0ZVZhbHVlID0gbmV3IERhdGUodGhpcy5wcm9wZXJ0eS52YWx1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRhdGVWYWx1ZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkJsdXIoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKCF0aGlzLmRhdGVWYWx1ZSAmJiBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAvLyB0aGlzLmhlbHBlclNlcnZpY2UuQVBQX1RPQVNUX01FU1NBR0UubmV4dCh7IHR5cGU6ICdFUlJPUicsIGNvZGU6ICdkYXRlSW52YWxpZCcsIG1lc3NhZ2U6IG51bGwgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gWHUgbHkgbmV1IG5ndW9pIGR1bmcgeG9hIGhldCBnaWEgdHJpIG5nYXkgdGhhbmdcclxuICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlID09PSAnJyAmJiB0aGlzLmRhdGVWYWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLmRhdGVWYWx1ZSA9IG51bGw7XHJcbiAgICAgIHRoaXMub25JbnB1dChudWxsKTtcclxuICAgIH1cclxuICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlID09PSAnJyAmJiB0aGlzLmRhdGVWYWx1ZSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMub25DaGFuZ2VkLmVtaXQoZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25JbnB1dChldmVudDogYW55KTogdm9pZCB7XHJcbiAgICBsZXQgcGFyc2VGb3JtYXQgPSB0aGlzLmluaXREYXRlRm9ybWF0UG9zaXRpb24oQ29tbW9uVXRpbHMuZ2V0RGF0ZUZvcm1hdCgpKTtcclxuICAgIGlmKHRoaXMuZGF0ZUZvcm1hdCA9PSAnbW0veXknKXtcclxuICAgICAgcGFyc2VGb3JtYXQgPSB0aGlzLmluaXREYXRlRm9ybWF0UG9zaXRpb24oJ01NL3l5eXknKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgIGxldCBjdXJzb3JQb3NpdGlvbiA9IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25FbmQ7XHJcbiAgICAgIC8vIGlmIChldmVudC5pbnB1dFR5cGUgPT09ICdkZWxldGVDb250ZW50QmFja3dhcmQnICYmIHBhcnNlRm9ybWF0LmlzQmFja3dhcmQoY3Vyc29yUG9zaXRpb24pKSB7XHJcbiAgICAgIC8vICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnN1YnN0cmluZygwLCBjdXJzb3JQb3NpdGlvbiAtIDEpICsgZXZlbnQudGFyZ2V0LnZhbHVlLnN1YnN0cmluZyhjdXJzb3JQb3NpdGlvbik7XHJcbiAgICAgIC8vICAgY3Vyc29yUG9zaXRpb24gLS07XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gaWYgKGV2ZW50LmlucHV0VHlwZSA9PT0gJ2luc2VydFRleHQnICYmIChldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gcGFyc2VGb3JtYXQubWF4TGVuZ3RoKSkge1xyXG4gICAgICAvLyAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnN1YnN0cmluZygwLCBldmVudC50YXJnZXQudmFsdWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIC8vIH1cclxuICAgICAgaWYgKHRoaXMub2xkUG9zID4gY3Vyc29yUG9zaXRpb24gJiYgcGFyc2VGb3JtYXQuaXNCYWNrd2FyZChjdXJzb3JQb3NpdGlvbikpIHtcclxuICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUuc3Vic3RyaW5nKDAsIGN1cnNvclBvc2l0aW9uIC0gMSkgKyBldmVudC50YXJnZXQudmFsdWUuc3Vic3RyaW5nKGN1cnNvclBvc2l0aW9uKTtcclxuICAgICAgICBjdXJzb3JQb3NpdGlvbi0tO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLm9sZFBvcyA8IGN1cnNvclBvc2l0aW9uICYmIChldmVudC50YXJnZXQudmFsdWUubGVuZ3RoID4gcGFyc2VGb3JtYXQubWF4TGVuZ3RoKSkge1xyXG4gICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZS5zdWJzdHJpbmcoMCwgZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCAtIDEpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMub2xkUG9zID0gZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZDtcclxuXHJcbiAgICAgIHRoaXMuZGF0ZU1hc2sgPSBldmVudC50YXJnZXQudmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgdGhpcy5kYXRlTWFzayA9IHRoaXMuZGF0ZU1hc2s/LnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbiAgICAgIGxldCBtYXNrID0gJyc7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRlTWFzay5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIG1hc2sgKz0gdGhpcy5kYXRlTWFza1tpXTtcclxuICAgICAgICBpZiAocGFyc2VGb3JtYXQuaXNGb3J3YXJkKGkpKSB7XHJcbiAgICAgICAgICBtYXNrICs9ICcvJztcclxuICAgICAgICAgIGlmIChwYXJzZUZvcm1hdC5pc0JhY2t3YXJkKGN1cnNvclBvc2l0aW9uKSkge1xyXG4gICAgICAgICAgICBjdXJzb3JQb3NpdGlvbisrO1xyXG4gICAgICAgICAgICB0aGlzLm9sZFBvcysrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gbWFzay50b1N0cmluZygpO1xyXG4gICAgICBldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPSBjdXJzb3JQb3NpdGlvbjtcclxuICAgICAgZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZCA9IGN1cnNvclBvc2l0aW9uO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5kYXRlVmFsdWUpIHtcclxuICAgICAgdGhpcy5wcm9wZXJ0eS5zZXRWYWx1ZSh0aGlzLmRhdGVWYWx1ZS5nZXRUaW1lKCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wcm9wZXJ0eS5zZXRWYWx1ZShudWxsKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm9uQ2hhbmdlKSB7XHJcbiAgICAgIHRoaXMub25DaGFuZ2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGluaXREYXRlRm9ybWF0UG9zaXRpb24oZGF0ZUZvcm1hdDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBtYXhMZW5ndGggPSBkYXRlRm9ybWF0Lmxlbmd0aDtcclxuICAgIGNvbnN0IGlNYXNrOiBhbnkgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0ZUZvcm1hdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBjaGFyID0gZGF0ZUZvcm1hdFtpXTtcclxuICAgICAgaWYgKCcvJyA9PT0gY2hhcikge1xyXG4gICAgICAgIGlNYXNrLnB1c2goaSAtIGlNYXNrLmxlbmd0aCA+IDAgPyAoaSAtIGlNYXNrLmxlbmd0aCAtIDEpIDogKGkgLSBpTWFzay5sZW5ndGgpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyc2UgPSB7XHJcbiAgICAgIG1heExlbmd0aDogbWF4TGVuZ3RoXHJcbiAgICAgICwgaXNCYWNrd2FyZDogKGN1cnNvclBvc2l0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBjaGFyID0gZGF0ZUZvcm1hdC5zdWJzdHIoY3Vyc29yUG9zaXRpb24sIDEpO1xyXG4gICAgICAgIHJldHVybiBjaGFyID09PSAnLyc7XHJcbiAgICAgIH0sIGlzRm9yd2FyZDogKGk6IGFueSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpTWFzay5pbmRleE9mKGkpID49IDA7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gcGFyc2U7XHJcbiAgfVxyXG5cclxuICBvblNlbGVjdChldmVudDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5kYXRlVmFsdWUpIHtcclxuICAgICAgdGhpcy5wcm9wZXJ0eS5zZXRWYWx1ZSh0aGlzLmRhdGVWYWx1ZS5nZXRUaW1lKCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wcm9wZXJ0eS5zZXRWYWx1ZShudWxsKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm9uQ2hhbmdlKSB7XHJcbiAgICAgIHRoaXMub25DaGFuZ2UoKTtcclxuICAgIH1cclxuICAgIHRoaXMub25DaGFuZ2VkLmVtaXQoZXZlbnQpO1xyXG4gIH1cclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwiZmllbGRcIj5cbiAgICA8bGFiZWwgY2xhc3M9XCJmb250LXNlbWlib2xkXCIgW25nQ2xhc3NdPVwieydyZXF1aXJlZCc6IHByb3BlcnR5LmlzUmVxdWlyZX1cIj57eyBsYWJlbFZhbHVlIH19PC9sYWJlbD5cbiAgICA8cC1jYWxlbmRhciBbKG5nTW9kZWwpXT1cImRhdGVWYWx1ZVwiIFtzaG93SWNvbl09XCJ0cnVlXCJcbiAgICAgICAgW2RhdGVGb3JtYXRdPVwiZGF0ZUZvcm1hdFwiXG4gICAgICAgIGNsYXNzPVwidy1mdWxsIGlubGluZS1ibG9ja1wiXG4gICAgICAgIGFwcGVuZFRvPVwiYm9keVwiXG4gICAgICAgIChvbklucHV0KT1cIm9uSW5wdXQoJGV2ZW50KVwiXG4gICAgICAgIChvblNlbGVjdCk9XCJvblNlbGVjdCgkZXZlbnQpXCJcbiAgICAgICAgKG9uQmx1cik9XCJvbkJsdXIoJGV2ZW50KVwiPjwvcC1jYWxlbmRhcj5cbiAgICA8YXBwLWNvbnRyb2wtbWVzc2FnZXMgW2NvbnRyb2xdPVwicHJvcGVydHlcIj48L2FwcC1jb250cm9sLW1lc3NhZ2VzPlxuPC9kaXY+XG4iXX0=