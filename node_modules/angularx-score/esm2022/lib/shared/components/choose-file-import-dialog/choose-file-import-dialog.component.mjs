import { Component } from '@angular/core';
import { BaseComponent } from '../base-component/base-component.component';
import { CommonUtils } from '../../services/common-utils.service';
import { saveAs } from 'file-saver';
import { ImportErrorListComponent } from '../import-error-list/import-error-list.component';
import * as i0 from "@angular/core";
import * as i1 from "primeng/dynamicdialog";
import * as i2 from "../../services/import-form.service";
import * as i3 from "@angular/common";
import * as i4 from "primeng/button";
import * as i5 from "@angular/forms";
import * as i6 from "primeng/radiobutton";
import * as i7 from "../../directive/drag-drop.directive";
import * as i8 from "../../directive/input-special.directive";
import * as i9 from "angular-l10n";
export class ChooseFileImportDialogComponent extends BaseComponent {
    constructor(_injector, dynamicDialogRef, config, importFormService, dialogService) {
        super(_injector);
        this._injector = _injector;
        this.dynamicDialogRef = dynamicDialogRef;
        this.config = config;
        this.importFormService = importFormService;
        this.dialogService = dialogService;
        this.selectedFile = null;
        this.urlApiDownloadTemp = '';
        this.urlApiImport = '';
        this.extraValue = {};
        this.errorList = [];
        this.actionType = 'THEM_MOI';
        this.showActionType = false;
        this.fileName = null;
        this.urlApiDownloadTemp = config.data.urlApiDownloadTemp;
        this.urlApiImport = config.data.urlApiImport;
        this.fileName = config.data.fileName;
        this.serviceAPI = config.data.serviceAPI;
        this.extraValue = config.data.extraValue || {};
        this.showActionType = config.data.showActionType;
    }
    filesDropped(event) {
        if (event && event.length > 1) {
            this.commonUtil.toastMessage('warn', 'common.toast.importMultiFile');
        }
        // validate file type
        // for (let i = 0; i < event.length; i++) {
        //   const file = event[i];
        //   console.log(' 12>>', file.file.name)
        // }
        this.selectedFile = event[0].file;
    }
    onFileInput(event) {
        const element = event.currentTarget;
        let fileList = element.files;
        if (!fileList || fileList.length > 1) {
            this.commonUtil.toastMessage('warn', 'common.toast.importMultiFile');
        }
        if (fileList == null || fileList.length == 0) {
            return;
        }
        this.selectedFile = fileList[0];
    }
    onRemoveFile(event) {
        event.stopPropagation();
        this.selectedFile = null;
    }
    onCancel() {
        this.dynamicDialogRef.close();
    }
    onDownloadTemplate() {
        this.importFormService.downloadTemplate(this.serviceAPI, this.urlApiDownloadTemp, this.extraValue).subscribe(res => {
            // const reportFile = new Blob([res], { type: getTypeExport('xlsx') });
            saveAs(res, `${this.fileName || 'template'}.xlsx`);
        });
    }
    onImport() {
        if (!this.selectedFile) {
            return;
        }
        // let formData = new FormData();
        // formData.append('file', this.selectedFile);
        const formData = CommonUtils.convertFormFile({
            ...this.extraValue,
            file: this.selectedFile,
            actionType: this.actionType
        });
        this.importFormService.doImport(this.serviceAPI, this.urlApiImport, formData).subscribe(res => {
            if (!CommonUtils.isSuccessRequest(res)) {
                this.ref = this.dialogService.open(ImportErrorListComponent, {
                    header: 'Danh sách lỗi',
                    width: CommonUtils.setWidthDiaglog('40%'),
                    contentStyle: { overflow: 'auto' },
                    baseZIndex: 99999,
                    maximizable: true,
                    data: {
                        errorList: res.data.errorList
                    }
                });
            }
            else {
                this.dynamicDialogRef.close(true);
            }
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: ChooseFileImportDialogComponent, deps: [{ token: i0.Injector }, { token: i1.DynamicDialogRef }, { token: i1.DynamicDialogConfig }, { token: i2.ImportFormService }, { token: i1.DialogService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.5", type: ChooseFileImportDialogComponent, selector: "app-choose-file-import-dialog", usesInheritance: true, ngImport: i0, template: "<div *ngIf=\"showActionType\">\n    <div class=\"field\">\n        <label class=\"font-semibold\">T\u00F9y ch\u1ECDn</label>\n        <div class=\"d-flex\">\n            <div class=\"field-checkbox mr-3\">\n                <p-radioButton [(ngModel)]=\"actionType\" inputId=\"THEM_MOI\" name=\"actionType\"\n                    [value]=\"'THEM_MOI'\"></p-radioButton>\n                <label for=\"THEM_MOI\" class=\"ml-2\">Th\u00EAm m\u1EDBi</label>\n            </div>\n            <div class=\"field-checkbox mr-3\">\n                <p-radioButton [(ngModel)]=\"actionType\" inputId=\"BO_SUNG\" name=\"actionType\"\n                    [value]=\"'BO_SUNG'\"></p-radioButton>\n                <label for=\"BO_SUNG\" class=\"ml-2\">B\u1ED5 sung</label>\n            </div>\n        </div>\n    </div>\n</div>\n<div class=\"mb-2 p-2 download-template\">\n    <a (click)=\"onDownloadTemplate()\"><i class=\"fa fa-download mr-2\"></i> Download file m\u1EABu</a>\n</div>\n<div class=\"image-upload-wrap d-flex align-items-center\" appDrag (files)=\"filesDropped($event)\"\n    (click)=\"fileInput.click()\">\n    <input #fileInput class=\"file-upload-input\" type='file' hidden (change)=\"onFileInput($event)\" accept=\".xls,.xlsx\" />\n    <div class=\"drag-text text-center flex-1\">\n        <div>\n            <img src=\"assets/images/svg/excel-file.svg\" alt=\"Upload file\" width=\"70px\">\n        </div>\n        <ng-container *ngIf=\"!selectedFile\">\n            <h5>T\u1EA3i t\u1EC7p l\u00EAn ho\u1EB7c th\u1EA3 t\u1EC7p t\u1EA1i \u0111\u00E2y</h5>\n        </ng-container>\n        <ng-container *ngIf=\"!!selectedFile\">\n            <div>\n                <span>{{ selectedFile.name }}</span>\n            </div>\n            <div>\n                <button pButton pRipple label=\"X\u00F3a\" class=\"p-button-danger p-button-rounded\"\n                    (click)=\"onRemoveFile($event)\"></button>\n            </div>\n        </ng-container>\n    </div>\n</div>\n<div class=\"pt-3 d-flex justify-content-center\">\n    <p-button icon=\"pi pi-times\" [label]=\"'common.label.cancel' | translateAsync\" styleClass=\"p-button-outlined\"\n        class=\"mr-2\" (onClick)=\"onCancel()\"></p-button>\n    <p-button icon=\"pi pi-upload\" [label]=\"'common.label.import' | translateAsync\" (onClick)=\"onImport()\"></p-button>\n</div>", styles: ["::ng-deep app-choose-file-import-dialog .image-upload-wrap{height:200px;border:#E9EAFF dashed 1px;border-radius:8px}::ng-deep app-choose-file-import-dialog .image-upload-wrap:hover{background-color:#e9eaff!important;cursor:pointer;border:#141ED2 dashed 1px}::ng-deep app-choose-file-import-dialog .download-template{border:solid 1px #E9EAFF;border-radius:8px}::ng-deep app-choose-file-import-dialog .download-template a:hover{cursor:pointer;text-decoration:underline!important;color:#141ed2!important}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.ButtonDirective, selector: "[pButton]", inputs: ["iconPos", "loadingIcon", "label", "icon", "loading"] }, { kind: "component", type: i4.Button, selector: "p-button", inputs: ["type", "iconPos", "icon", "badge", "label", "disabled", "loading", "loadingIcon", "style", "styleClass", "badgeClass", "ariaLabel"], outputs: ["onClick", "onFocus", "onBlur"] }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i6.RadioButton, selector: "p-radioButton", inputs: ["value", "formControlName", "name", "disabled", "label", "tabindex", "inputId", "ariaLabelledBy", "ariaLabel", "style", "styleClass", "labelStyleClass"], outputs: ["onClick", "onFocus", "onBlur"] }, { kind: "directive", type: i7.DragDirective, selector: "[appDrag]", outputs: ["files"] }, { kind: "directive", type: i8.InputSpecialDirective, selector: "input[type=\"text\"],input[type=\"email\"],input[type=\"tel\"],input:not([othertype=\"url\"]),textarea", inputs: ["type", "othertype"] }, { kind: "pipe", type: i9.L10nTranslateAsyncPipe, name: "translateAsync" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: ChooseFileImportDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-choose-file-import-dialog', template: "<div *ngIf=\"showActionType\">\n    <div class=\"field\">\n        <label class=\"font-semibold\">T\u00F9y ch\u1ECDn</label>\n        <div class=\"d-flex\">\n            <div class=\"field-checkbox mr-3\">\n                <p-radioButton [(ngModel)]=\"actionType\" inputId=\"THEM_MOI\" name=\"actionType\"\n                    [value]=\"'THEM_MOI'\"></p-radioButton>\n                <label for=\"THEM_MOI\" class=\"ml-2\">Th\u00EAm m\u1EDBi</label>\n            </div>\n            <div class=\"field-checkbox mr-3\">\n                <p-radioButton [(ngModel)]=\"actionType\" inputId=\"BO_SUNG\" name=\"actionType\"\n                    [value]=\"'BO_SUNG'\"></p-radioButton>\n                <label for=\"BO_SUNG\" class=\"ml-2\">B\u1ED5 sung</label>\n            </div>\n        </div>\n    </div>\n</div>\n<div class=\"mb-2 p-2 download-template\">\n    <a (click)=\"onDownloadTemplate()\"><i class=\"fa fa-download mr-2\"></i> Download file m\u1EABu</a>\n</div>\n<div class=\"image-upload-wrap d-flex align-items-center\" appDrag (files)=\"filesDropped($event)\"\n    (click)=\"fileInput.click()\">\n    <input #fileInput class=\"file-upload-input\" type='file' hidden (change)=\"onFileInput($event)\" accept=\".xls,.xlsx\" />\n    <div class=\"drag-text text-center flex-1\">\n        <div>\n            <img src=\"assets/images/svg/excel-file.svg\" alt=\"Upload file\" width=\"70px\">\n        </div>\n        <ng-container *ngIf=\"!selectedFile\">\n            <h5>T\u1EA3i t\u1EC7p l\u00EAn ho\u1EB7c th\u1EA3 t\u1EC7p t\u1EA1i \u0111\u00E2y</h5>\n        </ng-container>\n        <ng-container *ngIf=\"!!selectedFile\">\n            <div>\n                <span>{{ selectedFile.name }}</span>\n            </div>\n            <div>\n                <button pButton pRipple label=\"X\u00F3a\" class=\"p-button-danger p-button-rounded\"\n                    (click)=\"onRemoveFile($event)\"></button>\n            </div>\n        </ng-container>\n    </div>\n</div>\n<div class=\"pt-3 d-flex justify-content-center\">\n    <p-button icon=\"pi pi-times\" [label]=\"'common.label.cancel' | translateAsync\" styleClass=\"p-button-outlined\"\n        class=\"mr-2\" (onClick)=\"onCancel()\"></p-button>\n    <p-button icon=\"pi pi-upload\" [label]=\"'common.label.import' | translateAsync\" (onClick)=\"onImport()\"></p-button>\n</div>", styles: ["::ng-deep app-choose-file-import-dialog .image-upload-wrap{height:200px;border:#E9EAFF dashed 1px;border-radius:8px}::ng-deep app-choose-file-import-dialog .image-upload-wrap:hover{background-color:#e9eaff!important;cursor:pointer;border:#141ED2 dashed 1px}::ng-deep app-choose-file-import-dialog .download-template{border:solid 1px #E9EAFF;border-radius:8px}::ng-deep app-choose-file-import-dialog .download-template a:hover{cursor:pointer;text-decoration:underline!important;color:#141ed2!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Injector }, { type: i1.DynamicDialogRef }, { type: i1.DynamicDialogConfig }, { type: i2.ImportFormService }, { type: i1.DialogService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvb3NlLWZpbGUtaW1wb3J0LWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyeC1zY29yZS9zcmMvbGliL3NoYXJlZC9jb21wb25lbnRzL2Nob29zZS1maWxlLWltcG9ydC1kaWFsb2cvY2hvb3NlLWZpbGUtaW1wb3J0LWRpYWxvZy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyeC1zY29yZS9zcmMvbGliL3NoYXJlZC9jb21wb25lbnRzL2Nob29zZS1maWxlLWltcG9ydC1kaWFsb2cvY2hvb3NlLWZpbGUtaW1wb3J0LWRpYWxvZy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBRXBELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUMzRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFFbEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUVwQyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQzs7Ozs7Ozs7Ozs7QUFRNUYsTUFBTSxPQUFPLCtCQUFnQyxTQUFRLGFBQWE7SUFXaEUsWUFDVSxTQUFtQixFQUNwQixnQkFBa0MsRUFDbEMsTUFBMkIsRUFDMUIsaUJBQW9DLEVBQ3JDLGFBQTRCO1FBRW5DLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQU5ULGNBQVMsR0FBVCxTQUFTLENBQVU7UUFDcEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUMxQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3JDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBZnJDLGlCQUFZLEdB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QVk7WUFDdkIsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1NBQzVCLENBQUMsQ0FBQTtRQUNGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUM1RixJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN0QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLHdCQUF3QixFQUFFO29CQUMzRCxNQUFNLEVBQUUsZUFBZTtvQkFDdkIsS0FBSyxFQUFFLFdBQVcsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDO29CQUN6QyxZQUFZLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFO29CQUNsQyxVQUFVLEVBQUUsS0FBSztvQkFDakIsV0FBVyxFQUFFLElBQUk7b0JBQ2pCLElBQUksRUFBRTt3QkFDSixTQUFTLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTO3FCQUM5QjtpQkFDRixDQUFDLENBQUM7YUFDSjtpQkFBTTtnQkFDTCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ25DO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOzhHQS9GVSwrQkFBK0I7a0dBQS9CLCtCQUErQiw0RkNmNUMsc3lFQTZDTTs7MkZEOUJPLCtCQUErQjtrQkFMM0MsU0FBUzsrQkFDRSwrQkFBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZpbGVIYW5kbGUgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmUvZHJhZy1kcm9wLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IEJhc2VDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlLWNvbXBvbmVudC9iYXNlLWNvbXBvbmVudC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2NvbW1vbi11dGlscy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGlhbG9nU2VydmljZSwgRHluYW1pY0RpYWxvZ0NvbmZpZywgRHluYW1pY0RpYWxvZ1JlZiB9IGZyb20gJ3ByaW1lbmcvZHluYW1pY2RpYWxvZyc7XHJcbmltcG9ydCB7IHNhdmVBcyB9IGZyb20gJ2ZpbGUtc2F2ZXInO1xyXG5pbXBvcnQgeyBJbXBvcnRGb3JtU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2ltcG9ydC1mb3JtLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJbXBvcnRFcnJvckxpc3RDb21wb25lbnQgfSBmcm9tICcuLi9pbXBvcnQtZXJyb3ItbGlzdC9pbXBvcnQtZXJyb3ItbGlzdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCYXNlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2Jhc2ljLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtY2hvb3NlLWZpbGUtaW1wb3J0LWRpYWxvZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2Nob29zZS1maWxlLWltcG9ydC1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Nob29zZS1maWxlLWltcG9ydC1kaWFsb2cuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ2hvb3NlRmlsZUltcG9ydERpYWxvZ0NvbXBvbmVudCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xyXG4gIHNlbGVjdGVkRmlsZTogRmlsZSB8IG51bGwgPSBudWxsO1xyXG4gIHVybEFwaURvd25sb2FkVGVtcCA9ICcnO1xyXG4gIHVybEFwaUltcG9ydCA9ICcnO1xyXG4gIGV4dHJhVmFsdWUgPSB7fTtcclxuICBlcnJvckxpc3QgPSBbXTtcclxuICByZWY6IER5bmFtaWNEaWFsb2dSZWYgfCB1bmRlZmluZWQ7XHJcbiAgYWN0aW9uVHlwZSA9ICdUSEVNX01PSSc7XHJcbiAgc2hvd0FjdGlvblR5cGUgPSBmYWxzZTtcclxuICBmaWxlTmFtZSA9IG51bGw7XHJcbiAgc2VydmljZUFQSTogQmFzZVNlcnZpY2U7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9pbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwdWJsaWMgZHluYW1pY0RpYWxvZ1JlZjogRHluYW1pY0RpYWxvZ1JlZixcclxuICAgIHB1YmxpYyBjb25maWc6IER5bmFtaWNEaWFsb2dDb25maWcsXHJcbiAgICBwcml2YXRlIGltcG9ydEZvcm1TZXJ2aWNlOiBJbXBvcnRGb3JtU2VydmljZSxcclxuICAgIHB1YmxpYyBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgc3VwZXIoX2luamVjdG9yKTtcclxuICAgIHRoaXMudXJsQXBpRG93bmxvYWRUZW1wID0gY29uZmlnLmRhdGEudXJsQXBpRG93bmxvYWRUZW1wO1xyXG4gICAgdGhpcy51cmxBcGlJbXBvcnQgPSBjb25maWcuZGF0YS51cmxBcGlJbXBvcnQ7XHJcbiAgICB0aGlzLmZpbGVOYW1lID0gY29uZmlnLmRhdGEuZmlsZU5hbWU7XHJcbiAgICB0aGlzLnNlcnZpY2VBUEkgPSBjb25maWcuZGF0YS5zZXJ2aWNlQVBJO1xyXG4gICAgdGhpcy5leHRyYVZhbHVlID0gY29uZmlnLmRhdGEuZXh0cmFWYWx1ZSB8fCB7fTtcclxuICAgIHRoaXMuc2hvd0FjdGlvblR5cGUgPSBjb25maWcuZGF0YS5zaG93QWN0aW9uVHlwZTtcclxuICB9XHJcblxyXG4gIGZpbGVzRHJvcHBlZChldmVudDogRmlsZUhhbmRsZVtdKSB7XHJcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQubGVuZ3RoID4gMSkge1xyXG4gICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCd3YXJuJywgJ2NvbW1vbi50b2FzdC5pbXBvcnRNdWx0aUZpbGUnKTtcclxuICAgIH1cclxuICAgIC8vIHZhbGlkYXRlIGZpbGUgdHlwZVxyXG4gICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBldmVudC5sZW5ndGg7IGkrKykge1xyXG4gICAgLy8gICBjb25zdCBmaWxlID0gZXZlbnRbaV07XHJcbiAgICAvLyAgIGNvbnNvbGUubG9nKCcgMTI+PicsIGZpbGUuZmlsZS5uYW1lKVxyXG4gICAgIFxyXG4gICAgLy8gfVxyXG4gICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBldmVudFswXS5maWxlO1xyXG4gIH1cclxuXHJcbiAgb25GaWxlSW5wdXQoZXZlbnQ6IEV2ZW50KSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gZXZlbnQuY3VycmVudFRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgbGV0IGZpbGVMaXN0OiBGaWxlTGlzdCB8IG51bGwgPSBlbGVtZW50LmZpbGVzO1xyXG4gICAgaWYgKCFmaWxlTGlzdCB8fCBmaWxlTGlzdC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ3dhcm4nLCAnY29tbW9uLnRvYXN0LmltcG9ydE11bHRpRmlsZScpO1xyXG4gICAgfVxyXG4gICAgaWYgKGZpbGVMaXN0ID09IG51bGwgfHwgZmlsZUxpc3QubGVuZ3RoID09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBmaWxlTGlzdFswXTtcclxuICB9XHJcblxyXG4gIG9uUmVtb3ZlRmlsZShldmVudDogRXZlbnQpIHtcclxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgdGhpcy5zZWxlY3RlZEZpbGUgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgb25DYW5jZWwoKSB7XHJcbiAgICB0aGlzLmR5bmFtaWNEaWFsb2dSZWYuY2xvc2UoKTtcclxuICB9XHJcblxyXG4gIG9uRG93bmxvYWRUZW1wbGF0ZSgpIHtcclxuICAgIHRoaXMuaW1wb3J0Rm9ybVNlcnZpY2UuZG93bmxvYWRUZW1wbGF0ZSh0aGlzLnNlcnZpY2VBUEksIHRoaXMudXJsQXBpRG93bmxvYWRUZW1wLCB0aGlzLmV4dHJhVmFsdWUpLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICAvLyBjb25zdCByZXBvcnRGaWxlID0gbmV3IEJsb2IoW3Jlc10sIHsgdHlwZTogZ2V0VHlwZUV4cG9ydCgneGxzeCcpIH0pO1xyXG4gICAgICBzYXZlQXMocmVzLCBgJHsgdGhpcy5maWxlTmFtZSB8fCAndGVtcGxhdGUnIH0ueGxzeGApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvbkltcG9ydCgpIHtcclxuICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAvLyBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLnNlbGVjdGVkRmlsZSk7XHJcbiAgICBjb25zdCBmb3JtRGF0YSA9IENvbW1vblV0aWxzLmNvbnZlcnRGb3JtRmlsZSh7XHJcbiAgICAgIC4uLnRoaXMuZXh0cmFWYWx1ZSxcclxuICAgICAgZmlsZTogdGhpcy5zZWxlY3RlZEZpbGUsXHJcbiAgICAgIGFjdGlvblR5cGU6IHRoaXMuYWN0aW9uVHlwZVxyXG4gICAgfSlcclxuICAgIHRoaXMuaW1wb3J0Rm9ybVNlcnZpY2UuZG9JbXBvcnQodGhpcy5zZXJ2aWNlQVBJLCB0aGlzLnVybEFwaUltcG9ydCwgZm9ybURhdGEpLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICBpZiAoIUNvbW1vblV0aWxzLmlzU3VjY2Vzc1JlcXVlc3QocmVzKSkge1xyXG4gICAgICAgIHRoaXMucmVmID0gdGhpcy5kaWFsb2dTZXJ2aWNlLm9wZW4oSW1wb3J0RXJyb3JMaXN0Q29tcG9uZW50LCB7XHJcbiAgICAgICAgICBoZWFkZXI6ICdEYW5oIHPDoWNoIGzhu5dpJyxcclxuICAgICAgICAgIHdpZHRoOiBDb21tb25VdGlscy5zZXRXaWR0aERpYWdsb2coJzQwJScpLFxyXG4gICAgICAgICAgY29udGVudFN0eWxlOiB7IG92ZXJmbG93OiAnYXV0bycgfSxcclxuICAgICAgICAgIGJhc2VaSW5kZXg6IDk5OTk5LFxyXG4gICAgICAgICAgbWF4aW1pemFibGU6IHRydWUsXHJcbiAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgIGVycm9yTGlzdDogcmVzLmRhdGEuZXJyb3JMaXN0XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5keW5hbWljRGlhbG9nUmVmLmNsb3NlKHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiPGRpdiAqbmdJZj1cInNob3dBY3Rpb25UeXBlXCI+XG4gICAgPGRpdiBjbGFzcz1cImZpZWxkXCI+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImZvbnQtc2VtaWJvbGRcIj5Uw7l5IGNo4buNbjwvbGFiZWw+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXhcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmaWVsZC1jaGVja2JveCBtci0zXCI+XG4gICAgICAgICAgICAgICAgPHAtcmFkaW9CdXR0b24gWyhuZ01vZGVsKV09XCJhY3Rpb25UeXBlXCIgaW5wdXRJZD1cIlRIRU1fTU9JXCIgbmFtZT1cImFjdGlvblR5cGVcIlxuICAgICAgICAgICAgICAgICAgICBbdmFsdWVdPVwiJ1RIRU1fTU9JJ1wiPjwvcC1yYWRpb0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiVEhFTV9NT0lcIiBjbGFzcz1cIm1sLTJcIj5UaMOqbSBt4bubaTwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmaWVsZC1jaGVja2JveCBtci0zXCI+XG4gICAgICAgICAgICAgICAgPHAtcmFkaW9CdXR0b24gWyhuZ01vZGVsKV09XCJhY3Rpb25UeXBlXCIgaW5wdXRJZD1cIkJPX1NVTkdcIiBuYW1lPVwiYWN0aW9uVHlwZVwiXG4gICAgICAgICAgICAgICAgICAgIFt2YWx1ZV09XCInQk9fU1VORydcIj48L3AtcmFkaW9CdXR0b24+XG4gICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cIkJPX1NVTkdcIiBjbGFzcz1cIm1sLTJcIj5C4buVIHN1bmc8L2xhYmVsPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG48ZGl2IGNsYXNzPVwibWItMiBwLTIgZG93bmxvYWQtdGVtcGxhdGVcIj5cbiAgICA8YSAoY2xpY2spPVwib25Eb3dubG9hZFRlbXBsYXRlKClcIj48aSBjbGFzcz1cImZhIGZhLWRvd25sb2FkIG1yLTJcIj48L2k+IERvd25sb2FkIGZpbGUgbeG6q3U8L2E+XG48L2Rpdj5cbjxkaXYgY2xhc3M9XCJpbWFnZS11cGxvYWQtd3JhcCBkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCIgYXBwRHJhZyAoZmlsZXMpPVwiZmlsZXNEcm9wcGVkKCRldmVudClcIlxuICAgIChjbGljayk9XCJmaWxlSW5wdXQuY2xpY2soKVwiPlxuICAgIDxpbnB1dCAjZmlsZUlucHV0IGNsYXNzPVwiZmlsZS11cGxvYWQtaW5wdXRcIiB0eXBlPSdmaWxlJyBoaWRkZW4gKGNoYW5nZSk9XCJvbkZpbGVJbnB1dCgkZXZlbnQpXCIgYWNjZXB0PVwiLnhscywueGxzeFwiIC8+XG4gICAgPGRpdiBjbGFzcz1cImRyYWctdGV4dCB0ZXh0LWNlbnRlciBmbGV4LTFcIj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2ltYWdlcy9zdmcvZXhjZWwtZmlsZS5zdmdcIiBhbHQ9XCJVcGxvYWQgZmlsZVwiIHdpZHRoPVwiNzBweFwiPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFzZWxlY3RlZEZpbGVcIj5cbiAgICAgICAgICAgIDxoNT5U4bqjaSB04buHcCBsw6puIGhv4bq3YyB0aOG6oyB04buHcCB04bqhaSDEkcOieTwvaDU+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiISFzZWxlY3RlZEZpbGVcIj5cbiAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPHNwYW4+e3sgc2VsZWN0ZWRGaWxlLm5hbWUgfX08L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBwQnV0dG9uIHBSaXBwbGUgbGFiZWw9XCJYw7NhXCIgY2xhc3M9XCJwLWJ1dHRvbi1kYW5nZXIgcC1idXR0b24tcm91bmRlZFwiXG4gICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJvblJlbW92ZUZpbGUoJGV2ZW50KVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuPC9kaXY+XG48ZGl2IGNsYXNzPVwicHQtMyBkLWZsZXgganVzdGlmeS1jb250ZW50LWNlbnRlclwiPlxuICAgIDxwLWJ1dHRvbiBpY29uPVwicGkgcGktdGltZXNcIiBbbGFiZWxdPVwiJ2NvbW1vbi5sYWJlbC5jYW5jZWwnIHwgdHJhbnNsYXRlQXN5bmNcIiBzdHlsZUNsYXNzPVwicC1idXR0b24tb3V0bGluZWRcIlxuICAgICAgICBjbGFzcz1cIm1yLTJcIiAob25DbGljayk9XCJvbkNhbmNlbCgpXCI+PC9wLWJ1dHRvbj5cbiAgICA8cC1idXR0b24gaWNvbj1cInBpIHBpLXVwbG9hZFwiIFtsYWJlbF09XCInY29tbW9uLmxhYmVsLmltcG9ydCcgfCB0cmFuc2xhdGVBc3luY1wiIChvbkNsaWNrKT1cIm9uSW1wb3J0KClcIj48L3AtYnV0dG9uPlxuPC9kaXY+Il19