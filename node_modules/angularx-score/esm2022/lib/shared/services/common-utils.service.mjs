import { Injectable } from '@angular/core';
import { FormGroup, FormArray, FormControl, } from '@angular/forms';
import { HrStorage } from './HrStorage';
import { HttpParams } from '@angular/common/http';
import * as moment from 'moment';
import { CONFIG_DEFAULT, PERMISSION_CODE } from '../app-config';
import { BaseControl } from '../models/base.control';
import * as i0 from "@angular/core";
import * as i1 from "./helper.service";
export class CommonUtils {
    constructor(helperService) {
        this.helperService = helperService;
    }
    static isNullOrEmpty(str) {
        return !str || (str + '').trim() === '';
    }
    /**
   * Hàm lấy DateFormat hiện tại theo MarketCompany. Ko có trả về mặc định
   */
    static getDateFormat() {
        const nationProperty = HrStorage.getSelectedMarket();
        if (nationProperty === null || nationProperty === undefined || !nationProperty.dateFormat) {
            return CONFIG_DEFAULT.dateFormat;
        }
        return nationProperty.dateFormat;
    }
    /**
   * createFormNew use Dynamic Input
   */
    static createFormNew(resource, actionForm, formData, options, propConfigs, validate) {
        const formGroup = new FormGroup({});
        for (const property in options) {
            const config = propConfigs && propConfigs.length > 0
                ? propConfigs.filter(item => item.propertyCode === property && item.actionForm === actionForm)[0] : null;
            const control = new BaseControl();
            control.propertyName = property;
            control.actionForm = actionForm;
            control.resource = resource;
            control.configBaseControl(config, options[property][1]);
            control.setValue(options[property][0]);
            if (formData.hasOwnProperty(property)) {
                control.setValue(formData[property]);
            }
            control.setValidators(control.getListValidation());
            formGroup.addControl(property, control);
            formGroup.get(property)?.updateValueAndValidity();
        }
        if (validate) {
            formGroup.setValidators(validate);
        }
        return formGroup;
    }
    /**
   * convert To FormData mutilpart request post
   */
    static convertFormFile(dataPost) {
        const filteredData = CommonUtils.convertData(dataPost);
        const formData = CommonUtils.objectToFormData(filteredData, '', []);
        return formData;
    }
    /**
     * objectToFormData
     */
    static objectToFormData(obj, rootName, ignoreList) {
        const formData = new FormData();
        function appendFormData(data, root) {
            if (!ignore(root)) {
                root = root || '';
                if (data instanceof File) {
                    if (data.type !== 'x_stored_file') {
                        formData.append(root, data);
                    }
                }
                else if (Array.isArray(data)) {
                    let index = 0;
                    for (let i = 0; i < data.length; i++) {
                        if (data[i] instanceof File) {
                            if (data[i].type !== 'x_stored_file') {
                                appendFormData(data[i], root + '[' + index + ']');
                                index++;
                            }
                        }
                        else {
                            appendFormData(data[i], root + '[' + i + ']');
                        }
                    }
                }
                else if (data && typeof data === 'object') {
                    for (const key in data) {
                        if (data.hasOwnProperty(key)) {
                            if (root === '') {
                                appendFormData(data[key], key);
                            }
                            else {
                                appendFormData(data[key], root + '.' + key);
                            }
                        }
                    }
                }
                else {
                    if (data !== null && typeof data !== 'undefined') {
                        formData.append(root, data);
                    }
                }
            }
        }
        function ignore(root) {
            return Array.isArray(ignoreList) && ignoreList.some(function (x) { return x === root; });
        }
        appendFormData(obj, rootName);
        return formData;
    }
    /**
   * convertData
   */
    static convertData(data) {
        if (typeof data === typeof {}) {
            return CommonUtils.convertDataObject(data);
        }
        else if (typeof data === typeof []) {
            return CommonUtils.convertDataArray(data);
        }
        else if (typeof data === typeof true) {
            return CommonUtils.convertBoolean(data);
        }
        return data;
    }
    /**
     * convertDataObject
     * param data
     */
    static convertDataObject(data) {
        if (data) {
            for (const key in data) {
                if (data[key] instanceof File) {
                }
                else {
                    data[key] = CommonUtils.convertData(data[key]);
                }
            }
        }
        return data;
    }
    static convertDataArray(data) {
        if (data && data.length > 0) {
            for (const i in data) {
                data[i] = CommonUtils.convertData(data[i]);
            }
        }
        return data;
    }
    static convertBoolean(value) {
        return value ? 1 : 0;
    }
    /**
   * copyProperties
   * param dest
   * param orgs
   */
    static buildParams(obj) {
        return Object.entries(obj || {})
            .reduce((params, [key, value]) => {
            if (value === null) {
                return params.set(key, String(''));
            }
            else if (typeof value === typeof {}) {
                return params.set(key, JSON.stringify(value));
            }
            else {
                return params.set(key, String(value));
            }
        }, new HttpParams({ encoder: new CustomEncoder() }));
    }
    static buildParamsArray(obj) {
        return Object.entries(obj || {})
            .reduce((params, [key, value]) => {
            if (value === null) {
                return params.set(key, String(''));
            }
            else if (typeof value === typeof {}) {
                if (Array.isArray(value)) {
                    const temp = value;
                    if (temp && temp.length > 0) {
                        return temp.reduce((res, element, index) => {
                            return res.set(`${key}[${index}]`, JSON.stringify(element));
                        }, params);
                    }
                    return params;
                }
                else {
                    return params.set(key, JSON.stringify(value));
                }
            }
            else {
                return params.set(key, String(value));
            }
        }, new HttpParams({ encoder: new CustomEncoder() }));
    }
    /**
   * validateForm
   * @param form: FormGroup
   */
    static isValidForm(form) {
        setTimeout(() => {
            this.markAsTouched(form);
        }, 200);
        if (form.invalid) {
            setTimeout(() => {
                CommonUtils.scrollToSmoothly('.errorMessageDiv.show');
            }, 200);
        }
        return !form.invalid;
    }
    static offset(el) {
        const rect = el.getBoundingClientRect(), scrollLeft = window.pageXOffset || document.documentElement.scrollLeft, scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        return { top: rect.top + scrollTop, left: rect.left + scrollLeft };
    }
    static scrollToSmoothly(querySelectorAll, time) {
        const elements = document.querySelectorAll(querySelectorAll);
        if (!elements) {
            return;
        }
        const first = elements[0];
        if (!first) {
            return;
        }
        const position = CommonUtils.offset(first);
        if (isNaN(position.top)) {
            console.warn('Position must be a number');
            return;
        }
        if (position.top < 0) {
            console.warn('Position can not be negative');
            return;
        }
        let top = position.top - 100;
        const currentPos = window.scrollY || window.screenTop;
        if (currentPos > position.top) {
            top = position.top + 100;
        }
        try {
            window.scrollTo({ left: 0, top: top, behavior: 'smooth' });
        }
        catch (e) {
            window.scrollTo(0, top);
        }
    }
    static markAsTouched(form) {
        if (form instanceof FormGroup) {
            CommonUtils.isValidFormGroup(form);
        }
        else if (form instanceof FormArray) {
            CommonUtils.isValidFormArray(form);
        }
        else if (form instanceof FormControl) {
            form.markAsTouched({ onlySelf: true });
            if (form.invalid) {
                console.warn('Validate error field:', form);
            }
        }
    }
    static isValidFormArray(form) {
        if (form['isHidden'] === true) { // neu form đang bị ẩn thì không cần validate
            return;
        }
        for (const i in form.controls) {
            CommonUtils.markAsTouched(form.controls[i]); // neu form đang bị ẩn thì không cần validate
        }
    }
    static isValidFormGroup(form) {
        if (form['isHidden'] === true) {
            return;
        }
        Object.keys(form.controls).forEach(key => {
            CommonUtils.markAsTouched(form.get(key));
        });
    }
    /**
   * convertData
   */
    convertData(data) {
        if (typeof data === typeof {}) {
            return data;
        }
        else if (typeof data === typeof []) {
            return this.convertDataArray(data);
        }
        else if (typeof data === typeof true) {
            return this.convertBoolean(data);
        }
        return data;
    }
    convertDataArray(data) {
        if (data && data.length > 0) {
            // tslint:disable-next-line: forin
            for (const i in data) {
                data[i] = this.convertData(data[i]);
            }
        }
        return data;
    }
    convertBoolean(value) {
        return value ? 1 : 0;
    }
    /**
     * copyProperties
     * param dest
     * param orgs
     */
    buildParams(obj) {
        return Object.entries(obj || {})
            .reduce((params, [key, value]) => {
            if (value === null) {
                return params.set(key, String(''));
            }
            else if (typeof value === typeof {}) {
                if (Array.isArray(value)) {
                    return params.set(key, value.join());
                }
                else {
                    return params.set(key, JSON.stringify(value));
                }
            }
            else {
                return params.set(key, String(value));
            }
        }, new HttpParams());
    }
    toastMessage(severity, code, data) {
        this.helperService.MESSAGE_TOASTER.next({
            severity,
            code,
            value: data
        });
    }
    /**
   * convert To FormData mutilpart request post
   */
    convertFormFile(dataPost) {
        const filteredData = this.convertData(dataPost);
        const formData = this.objectToFormData(filteredData, '', []);
        return formData;
    }
    /**
     * objectToFormData
     */
    objectToFormData(obj, rootName, ignoreList) {
        const formData = new FormData();
        function appendFormData(data, root) {
            if (!ignore(root)) {
                root = root || '';
                if (data instanceof File) {
                    if (data.type !== 'stored_file') {
                        formData.append(root, data);
                    }
                }
                else if (Array.isArray(data)) {
                    let index = 0;
                    for (let i = 0; i < data.length; i++) {
                        if (data[i] instanceof File) {
                            if (data[i].type !== 'stored_file') {
                                appendFormData(data[i], root + '[' + index + ']');
                                index++;
                            }
                        }
                        else {
                            appendFormData(data[i], root + '[' + i + ']');
                        }
                    }
                }
                else if (data && typeof data === 'object') {
                    for (const key in data) {
                        if (data.hasOwnProperty(key)) {
                            if (root === '') {
                                appendFormData(data[key], key);
                            }
                            else {
                                appendFormData(data[key], root + '.' + key);
                            }
                        }
                    }
                }
                else {
                    if (data !== null && typeof data !== 'undefined') {
                        formData.append(root, data);
                    }
                }
            }
        }
        function ignore(root) {
            return Array.isArray(ignoreList) && ignoreList.some(x => x === root);
        }
        appendFormData(obj, rootName);
        return formData;
    }
    static isSuccessRequest(res) {
        return res && res.type === 'SUCCESS';
    }
    static dateToString(date) {
        return moment(date).format('DD/MM/YYYY');
    }
    static logoutAction(router) {
        HrStorage.clear();
        router.navigate(['/auth/login']);
    }
    /**
   * getPermissionCode
   * @param code: string
   */
    static getPermissionCode(code) {
        return PERMISSION_CODE[code] || '';
    }
    /**
   * has Permission
   */
    static havePermission(operationKey, adResourceKey) {
        const permissionCode = this.getPermissionCode(adResourceKey) + '__' + this.getPermissionCode(operationKey);
        const userInfo = HrStorage.getUserToken();
        if (userInfo == null) {
            return false;
        }
        // if (!userInfo.userId) {
        //   return false;
        // }
        const userPermissionList = userInfo.userPermissionList;
        if (userPermissionList == null || userPermissionList.length <= 0) {
            return false;
        }
        for (const userPermission of userPermissionList) {
            if (userPermission.permission === permissionCode) {
                return true;
            }
        }
        return false;
    }
    static setWidthDiaglog(defaultValue) {
        var isMobile = navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);
        return isMobile ? '90%' : defaultValue;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: CommonUtils, deps: [{ token: i1.HelperService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: CommonUtils, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: CommonUtils, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.HelperService }]; } });
class CustomEncoder {
    encodeKey(key) {
        return encodeURIComponent(key);
    }
    encodeValue(value) {
        return encodeURIComponent(value);
    }
    decodeKey(key) {
        return decodeURIComponent(key);
    }
    decodeValue(value) {
        return decodeURIComponent(value);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLXV0aWxzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyeC1zY29yZS9zcmMvbGliL3NoYXJlZC9zZXJ2aWNlcy9jb21tb24tdXRpbHMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsR0FBRyxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEMsT0FBTyxFQUFFLFVBQVUsRUFBc0IsTUFBTSxzQkFBc0IsQ0FBQztBQUV0RSxPQUFPLEtBQUssTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUdqQyxPQUFPLEVBQWUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7OztBQUtyRCxNQUFNLE9BQU8sV0FBVztJQUNwQixZQUNZLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO0lBRXhDLENBQUM7SUFFTSxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQVE7UUFDaEMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUM7SUFDNUMsQ0FBQztJQUVEOztLQUVDO0lBQ00sTUFBTSxDQUFDLGFBQWE7UUFDdkIsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDckQsSUFBSSxjQUFjLEtBQUssSUFBSSxJQUFJLGNBQWMsS0FBSyxTQUFTLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFO1lBQ3ZGLE9BQU8sY0FBYyxDQUFDLFVBQVUsQ0FBQztTQUNwQztR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IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUFycmF5LCBGb3JtQ29udHJvbCwgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEhyU3RvcmFnZSB9IGZyb20gJy4vSHJTdG9yYWdlJztcclxuaW1wb3J0IHsgSHR0cFBhcmFtcywgSHR0cFBhcmFtZXRlckNvZGVjIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnLi9oZWxwZXIuc2VydmljZSc7XHJcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xyXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBTeXNQcm9wZXJ0eURldGFpbEJlYW4gfSBmcm9tICcuLi9tb2RlbHMvc3lzLXByb3BlcnR5LWRldGFpbHMubW9kZWwnO1xyXG5pbXBvcnQgeyBBQ1RJT05fRk9STSwgQ09ORklHX0RFRkFVTFQsIFBFUk1JU1NJT05fQ09ERSB9IGZyb20gJy4uL2FwcC1jb25maWcnO1xyXG5pbXBvcnQgeyBCYXNlQ29udHJvbCB9IGZyb20gJy4uL21vZGVscy9iYXNlLmNvbnRyb2wnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb21tb25VdGlscyB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGhlbHBlclNlcnZpY2U6IEhlbHBlclNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgaXNOdWxsT3JFbXB0eShzdHI6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhc3RyIHx8IChzdHIgKyAnJykudHJpbSgpID09PSAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBIw6BtIGzhuqV5IERhdGVGb3JtYXQgaGnhu4duIHThuqFpIHRoZW8gTWFya2V0Q29tcGFueS4gS28gY8OzIHRy4bqjIHbhu4EgbeG6t2MgxJHhu4tuaFxyXG4gICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXREYXRlRm9ybWF0KCk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgbmF0aW9uUHJvcGVydHkgPSBIclN0b3JhZ2UuZ2V0U2VsZWN0ZWRNYXJrZXQoKTtcclxuICAgICAgICBpZiAobmF0aW9uUHJvcGVydHkgPT09IG51bGwgfHwgbmF0aW9uUHJvcGVydHkgPT09IHVuZGVmaW5lZCB8fCAhbmF0aW9uUHJvcGVydHkuZGF0ZUZvcm1hdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gQ09ORklHX0RFRkFVTFQuZGF0ZUZvcm1hdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5hdGlvblByb3BlcnR5LmRhdGVGb3JtYXQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAqIGNyZWF0ZUZvcm1OZXcgdXNlIER5bmFtaWMgSW5wdXRcclxuICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlRm9ybU5ldyhyZXNvdXJjZTogc3RyaW5nXHJcbiAgICAgICAgLCBhY3Rpb25Gb3JtOiBBQ1RJT05fRk9STVxyXG4gICAgICAgICwgZm9ybURhdGE6IGFueVxyXG4gICAgICAgICwgb3B0aW9uczogYW55XHJcbiAgICAgICAgLCBwcm9wQ29uZmlncz86IEFycmF5PFN5c1Byb3BlcnR5RGV0YWlsQmVhbj5cclxuICAgICAgICAsIHZhbGlkYXRlPzogYW55KTogRm9ybUdyb3VwIHtcclxuICAgICAgICBjb25zdCBmb3JtR3JvdXAgPSBuZXcgRm9ybUdyb3VwKHt9KTtcclxuICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgY29uZmlnID0gcHJvcENvbmZpZ3MgJiYgcHJvcENvbmZpZ3MubGVuZ3RoID4gMFxyXG4gICAgICAgICAgICAgICAgPyBwcm9wQ29uZmlncy5maWx0ZXIoaXRlbSA9PiBpdGVtLnByb3BlcnR5Q29kZSA9PT0gcHJvcGVydHkgJiYgaXRlbS5hY3Rpb25Gb3JtID09PSBhY3Rpb25Gb3JtKVswXSA6IG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyb2wgPSBuZXcgQmFzZUNvbnRyb2woKTtcclxuICAgICAgICAgICAgY29udHJvbC5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eTtcclxuICAgICAgICAgICAgY29udHJvbC5hY3Rpb25Gb3JtID0gYWN0aW9uRm9ybTtcclxuICAgICAgICAgICAgY29udHJvbC5yZXNvdXJjZSA9IHJlc291cmNlO1xyXG4gICAgICAgICAgICBjb250cm9sLmNvbmZpZ0Jhc2VDb250cm9sKGNvbmZpZywgb3B0aW9uc1twcm9wZXJ0eV1bMV0pO1xyXG4gICAgICAgICAgICBjb250cm9sLnNldFZhbHVlKG9wdGlvbnNbcHJvcGVydHldWzBdKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChmb3JtRGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2wuc2V0VmFsdWUoZm9ybURhdGFbcHJvcGVydHldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250cm9sLnNldFZhbGlkYXRvcnMoY29udHJvbC5nZXRMaXN0VmFsaWRhdGlvbigpKTtcclxuICAgICAgICAgICAgZm9ybUdyb3VwLmFkZENvbnRyb2wocHJvcGVydHksIGNvbnRyb2wpO1xyXG4gICAgICAgICAgICBmb3JtR3JvdXAuZ2V0KHByb3BlcnR5KT8udXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmFsaWRhdGUpIHtcclxuICAgICAgICAgICAgZm9ybUdyb3VwLnNldFZhbGlkYXRvcnModmFsaWRhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZm9ybUdyb3VwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIGNvbnZlcnQgVG8gRm9ybURhdGEgbXV0aWxwYXJ0IHJlcXVlc3QgcG9zdFxyXG4gICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBjb252ZXJ0Rm9ybUZpbGUoZGF0YVBvc3Q6IGFueSk6IEZvcm1EYXRhIHtcclxuICAgICAgICBjb25zdCBmaWx0ZXJlZERhdGEgPSBDb21tb25VdGlscy5jb252ZXJ0RGF0YShkYXRhUG9zdCk7XHJcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBDb21tb25VdGlscy5vYmplY3RUb0Zvcm1EYXRhKGZpbHRlcmVkRGF0YSwgJycsIFtdKTtcclxuICAgICAgICByZXR1cm4gZm9ybURhdGE7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIG9iamVjdFRvRm9ybURhdGFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBvYmplY3RUb0Zvcm1EYXRhKG9iajogYW55LCByb290TmFtZTogYW55LCBpZ25vcmVMaXN0OiBhbnkpOiBGb3JtRGF0YSB7XHJcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmdW5jdGlvbiBhcHBlbmRGb3JtRGF0YShkYXRhOiBhbnksIHJvb3Q6IGFueSkge1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZShyb290KSkge1xyXG4gICAgICAgICAgICAgICAgcm9vdCA9IHJvb3QgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAneF9zdG9yZWRfZmlsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHJvb3QsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldIGluc3RhbmNlb2YgRmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0udHlwZSAhPT0gJ3hfc3RvcmVkX2ZpbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kRm9ybURhdGEoZGF0YVtpXSwgcm9vdCArICdbJyArIGluZGV4ICsgJ10nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kRm9ybURhdGEoZGF0YVtpXSwgcm9vdCArICdbJyArIGkgKyAnXScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb3QgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kRm9ybURhdGEoZGF0YVtrZXldLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRGb3JtRGF0YShkYXRhW2tleV0sIHJvb3QgKyAnLicgKyBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gbnVsbCAmJiB0eXBlb2YgZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHJvb3QsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaWdub3JlKHJvb3Q6IGFueSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShpZ25vcmVMaXN0KSAmJiBpZ25vcmVMaXN0LnNvbWUoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggPT09IHJvb3Q7IH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXBwZW5kRm9ybURhdGEob2JqLCByb290TmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1EYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIGNvbnZlcnREYXRhXHJcbiAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbnZlcnREYXRhKGRhdGE6IGFueSk6IGFueSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSB0eXBlb2Yge30pIHtcclxuICAgICAgICAgICAgcmV0dXJuIENvbW1vblV0aWxzLmNvbnZlcnREYXRhT2JqZWN0KGRhdGEpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09IHR5cGVvZiBbXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQ29tbW9uVXRpbHMuY29udmVydERhdGFBcnJheShkYXRhKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSB0eXBlb2YgdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQ29tbW9uVXRpbHMuY29udmVydEJvb2xlYW4oZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBjb252ZXJ0RGF0YU9iamVjdFxyXG4gICAgICogcGFyYW0gZGF0YVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbnZlcnREYXRhT2JqZWN0KGRhdGE6IE9iamVjdCk6IE9iamVjdCB7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKChkYXRhIGFzIGFueSlba2V5XSBpbnN0YW5jZW9mIEZpbGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIChkYXRhIGFzIGFueSlba2V5XSA9IENvbW1vblV0aWxzLmNvbnZlcnREYXRhKChkYXRhIGFzIGFueSlba2V5XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbnZlcnREYXRhQXJyYXkoZGF0YTogQXJyYXk8YW55Pik6IEFycmF5PGFueT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGkgaW4gZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpXSA9IENvbW1vblV0aWxzLmNvbnZlcnREYXRhKGRhdGFbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBjb252ZXJ0Qm9vbGVhbih2YWx1ZTogQm9vbGVhbik6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gMSA6IDA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICogY29weVByb3BlcnRpZXNcclxuICAgKiBwYXJhbSBkZXN0XHJcbiAgICogcGFyYW0gb3Jnc1xyXG4gICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBidWlsZFBhcmFtcyhvYmo6IGFueSk6IEh0dHBQYXJhbXMge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyhvYmogfHwge30pXHJcbiAgICAgICAgICAgIC5yZWR1Y2UoKHBhcmFtcywgW2tleSwgdmFsdWVdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLnNldChrZXksIFN0cmluZygnJykpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IHR5cGVvZiB7fSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbXMuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5zZXQoa2V5LCBTdHJpbmcodmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgbmV3IEh0dHBQYXJhbXMoeyBlbmNvZGVyOiBuZXcgQ3VzdG9tRW5jb2RlcigpIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGJ1aWxkUGFyYW1zQXJyYXkob2JqOiBhbnkpOiBIdHRwUGFyYW1zIHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMob2JqIHx8IHt9KVxyXG4gICAgICAgICAgICAucmVkdWNlKChwYXJhbXMsIFtrZXksIHZhbHVlXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5zZXQoa2V5LCBTdHJpbmcoJycpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSB0eXBlb2Yge30pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHZhbHVlIGFzIFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCAmJiB0ZW1wLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wLnJlZHVjZSgocmVzLCBlbGVtZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc2V0KGAke2tleX1bJHtpbmRleH1dYCwgSlNPTi5zdHJpbmdpZnkoZWxlbWVudCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBwYXJhbXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLnNldChrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLnNldChrZXksIFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBuZXcgSHR0cFBhcmFtcyh7IGVuY29kZXI6IG5ldyBDdXN0b21FbmNvZGVyKCkgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIHZhbGlkYXRlRm9ybVxyXG4gICAqIEBwYXJhbSBmb3JtOiBGb3JtR3JvdXBcclxuICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgaXNWYWxpZEZvcm0oZm9ybTogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubWFya0FzVG91Y2hlZChmb3JtKTtcclxuICAgICAgICB9LCAyMDApO1xyXG5cclxuICAgICAgICBpZiAoZm9ybS5pbnZhbGlkKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgQ29tbW9uVXRpbHMuc2Nyb2xsVG9TbW9vdGhseSgnLmVycm9yTWVzc2FnZURpdi5zaG93Jyk7XHJcbiAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAhZm9ybS5pbnZhbGlkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgb2Zmc2V0KGVsOiBFbGVtZW50KTogYW55IHtcclxuICAgICAgICBjb25zdCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIHNjcm9sbExlZnQgPSB3aW5kb3cucGFnZVhPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQsXHJcbiAgICAgICAgICAgIHNjcm9sbFRvcCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgIHJldHVybiB7IHRvcDogcmVjdC50b3AgKyBzY3JvbGxUb3AsIGxlZnQ6IHJlY3QubGVmdCArIHNjcm9sbExlZnQgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHNjcm9sbFRvU21vb3RobHkocXVlcnlTZWxlY3RvckFsbDogc3RyaW5nLCB0aW1lPzogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5U2VsZWN0b3JBbGwpO1xyXG4gICAgICAgIGlmICghZWxlbWVudHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaXJzdCA9IGVsZW1lbnRzWzBdO1xyXG4gICAgICAgIGlmICghZmlyc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IENvbW1vblV0aWxzLm9mZnNldChmaXJzdCk7XHJcbiAgICAgICAgaWYgKGlzTmFOKHBvc2l0aW9uLnRvcCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdQb3NpdGlvbiBtdXN0IGJlIGEgbnVtYmVyJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBvc2l0aW9uLnRvcCA8IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdQb3NpdGlvbiBjYW4gbm90IGJlIG5lZ2F0aXZlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHRvcCA9IHBvc2l0aW9uLnRvcCAtIDEwMDtcclxuICAgICAgICBjb25zdCBjdXJyZW50UG9zID0gd2luZG93LnNjcm9sbFkgfHwgd2luZG93LnNjcmVlblRvcDtcclxuICAgICAgICBpZiAoY3VycmVudFBvcyA+IHBvc2l0aW9uLnRvcCkge1xyXG4gICAgICAgICAgICB0b3AgPSBwb3NpdGlvbi50b3AgKyAxMDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7IGxlZnQ6IDAsIHRvcDogdG9wLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgdG9wKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBtYXJrQXNUb3VjaGVkKGZvcm06IGFueSkge1xyXG4gICAgICAgIGlmIChmb3JtIGluc3RhbmNlb2YgRm9ybUdyb3VwKSB7XHJcbiAgICAgICAgICAgIENvbW1vblV0aWxzLmlzVmFsaWRGb3JtR3JvdXAoZm9ybSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtIGluc3RhbmNlb2YgRm9ybUFycmF5KSB7XHJcbiAgICAgICAgICAgIENvbW1vblV0aWxzLmlzVmFsaWRGb3JtQXJyYXkoZm9ybSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtIGluc3RhbmNlb2YgRm9ybUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgZm9ybS5tYXJrQXNUb3VjaGVkKHsgb25seVNlbGY6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIGlmIChmb3JtLmludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVmFsaWRhdGUgZXJyb3IgZmllbGQ6JywgZm9ybSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpc1ZhbGlkRm9ybUFycmF5KGZvcm06IEZvcm1BcnJheSkge1xyXG4gICAgICAgIGlmICgoZm9ybSBhcyBhbnkpWydpc0hpZGRlbiddID09PSB0cnVlKSB7Ly8gbmV1IGZvcm0gxJFhbmcgYuG7iyDhuqluIHRow6wga2jDtG5nIGPhuqduIHZhbGlkYXRlXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChjb25zdCBpIGluIGZvcm0uY29udHJvbHMpIHtcclxuICAgICAgICAgICAgQ29tbW9uVXRpbHMubWFya0FzVG91Y2hlZChmb3JtLmNvbnRyb2xzW2ldKTsgLy8gbmV1IGZvcm0gxJFhbmcgYuG7iyDhuqluIHRow6wga2jDtG5nIGPhuqduIHZhbGlkYXRlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBpc1ZhbGlkRm9ybUdyb3VwKGZvcm06IEZvcm1Hcm91cCkge1xyXG4gICAgICAgIGlmICgoZm9ybSBhcyBhbnkpWydpc0hpZGRlbiddID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmtleXMoZm9ybS5jb250cm9scykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBDb21tb25VdGlscy5tYXJrQXNUb3VjaGVkKGZvcm0uZ2V0KGtleSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIGNvbnZlcnREYXRhXHJcbiAgICovXHJcbiAgICBwdWJsaWMgY29udmVydERhdGEoZGF0YTogYW55KTogYW55IHtcclxuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09IHR5cGVvZiB7fSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSB0eXBlb2YgW10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydERhdGFBcnJheShkYXRhKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSB0eXBlb2YgdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0Qm9vbGVhbihkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNvbnZlcnREYXRhQXJyYXkoZGF0YTogQXJyYXk8YW55Pik6IEFycmF5PGFueT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGZvcmluXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBpbiBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2ldID0gdGhpcy5jb252ZXJ0RGF0YShkYXRhW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBjb252ZXJ0Qm9vbGVhbih2YWx1ZTogYm9vbGVhbik6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gMSA6IDA7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogY29weVByb3BlcnRpZXNcclxuICAgICAqIHBhcmFtIGRlc3RcclxuICAgICAqIHBhcmFtIG9yZ3NcclxuICAgICAqL1xyXG4gICAgcHVibGljIGJ1aWxkUGFyYW1zKG9iajogYW55KTogSHR0cFBhcmFtcyB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKG9iaiB8fCB7fSlcclxuICAgICAgICAgICAgLnJlZHVjZSgocGFyYW1zLCBba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbXMuc2V0KGtleSwgU3RyaW5nKCcnKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gdHlwZW9mIHt9KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbXMuc2V0KGtleSwgdmFsdWUuam9pbigpKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLnNldChrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLnNldChrZXksIFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBuZXcgSHR0cFBhcmFtcygpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdG9hc3RNZXNzYWdlKHNldmVyaXR5OiAnc3VjY2VzcycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InLCBjb2RlOiBzdHJpbmcsIGRhdGE/OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuTUVTU0FHRV9UT0FTVEVSLm5leHQoe1xyXG4gICAgICAgICAgICBzZXZlcml0eSxcclxuICAgICAgICAgICAgY29kZSxcclxuICAgICAgICAgICAgdmFsdWU6IGRhdGFcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBjb252ZXJ0IFRvIEZvcm1EYXRhIG11dGlscGFydCByZXF1ZXN0IHBvc3RcclxuICAgKi9cclxuICAgIHB1YmxpYyBjb252ZXJ0Rm9ybUZpbGUoZGF0YVBvc3Q6IGFueSk6IEZvcm1EYXRhIHtcclxuICAgICAgICBjb25zdCBmaWx0ZXJlZERhdGEgPSB0aGlzLmNvbnZlcnREYXRhKGRhdGFQb3N0KTtcclxuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IHRoaXMub2JqZWN0VG9Gb3JtRGF0YShmaWx0ZXJlZERhdGEsICcnLCBbXSk7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1EYXRhO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBvYmplY3RUb0Zvcm1EYXRhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvYmplY3RUb0Zvcm1EYXRhKG9iajogYW55LCByb290TmFtZTogYW55LCBpZ25vcmVMaXN0OiBhbnkpOiBGb3JtRGF0YSB7XHJcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmdW5jdGlvbiBhcHBlbmRGb3JtRGF0YShkYXRhOiBhbnksIHJvb3Q6IGFueSk6IHZvaWQge1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZShyb290KSkge1xyXG4gICAgICAgICAgICAgICAgcm9vdCA9IHJvb3QgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAnc3RvcmVkX2ZpbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChyb290LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXSBpbnN0YW5jZW9mIEZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldLnR5cGUgIT09ICdzdG9yZWRfZmlsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRGb3JtRGF0YShkYXRhW2ldLCByb290ICsgJ1snICsgaW5kZXggKyAnXScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRGb3JtRGF0YShkYXRhW2ldLCByb290ICsgJ1snICsgaSArICddJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm9vdCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRGb3JtRGF0YShkYXRhW2tleV0sIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZEZvcm1EYXRhKGRhdGFba2V5XSwgcm9vdCArICcuJyArIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSBudWxsICYmIHR5cGVvZiBkYXRhICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQocm9vdCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpZ25vcmUocm9vdDogYW55KTogYW55IHtcclxuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaWdub3JlTGlzdCkgJiYgaWdub3JlTGlzdC5zb21lKHggPT4geCA9PT0gcm9vdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhcHBlbmRGb3JtRGF0YShvYmosIHJvb3ROYW1lKTtcclxuICAgICAgICByZXR1cm4gZm9ybURhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpc1N1Y2Nlc3NSZXF1ZXN0KHJlczogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcyAmJiByZXMudHlwZSA9PT0gJ1NVQ0NFU1MnO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZGF0ZVRvU3RyaW5nKGRhdGU6IERhdGUpIHtcclxuICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgnREQvTU0vWVlZWScpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgbG9nb3V0QWN0aW9uKHJvdXRlcjogUm91dGVyKSB7XHJcbiAgICAgICAgSHJTdG9yYWdlLmNsZWFyKCk7XHJcbiAgICAgICAgcm91dGVyLm5hdmlnYXRlKFsnL2F1dGgvbG9naW4nXSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICogZ2V0UGVybWlzc2lvbkNvZGVcclxuICAgKiBAcGFyYW0gY29kZTogc3RyaW5nXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXRQZXJtaXNzaW9uQ29kZShjb2RlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIFBFUk1JU1NJT05fQ09ERVtjb2RlXSB8fCAnJztcclxuICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICogaGFzIFBlcm1pc3Npb25cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGhhdmVQZXJtaXNzaW9uKG9wZXJhdGlvbktleTogc3RyaW5nLCBhZFJlc291cmNlS2V5OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHBlcm1pc3Npb25Db2RlID0gdGhpcy5nZXRQZXJtaXNzaW9uQ29kZShhZFJlc291cmNlS2V5KSArICdfXycgKyB0aGlzLmdldFBlcm1pc3Npb25Db2RlKG9wZXJhdGlvbktleSk7XHJcbiAgICBjb25zdCB1c2VySW5mbyA9IEhyU3RvcmFnZS5nZXRVc2VyVG9rZW4oKTtcclxuICAgIGlmICh1c2VySW5mbyA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiAoIXVzZXJJbmZvLnVzZXJJZCkge1xyXG4gICAgLy8gICByZXR1cm4gZmFsc2U7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgY29uc3QgdXNlclBlcm1pc3Npb25MaXN0ID0gdXNlckluZm8udXNlclBlcm1pc3Npb25MaXN0O1xyXG4gICAgaWYgKHVzZXJQZXJtaXNzaW9uTGlzdCA9PSBudWxsIHx8IHVzZXJQZXJtaXNzaW9uTGlzdC5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCB1c2VyUGVybWlzc2lvbiBvZiB1c2VyUGVybWlzc2lvbkxpc3QpIHtcclxuICAgICAgaWYgKHVzZXJQZXJtaXNzaW9uLnBlcm1pc3Npb24gPT09IHBlcm1pc3Npb25Db2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIHNldFdpZHRoRGlhZ2xvZyhkZWZhdWx0VmFsdWU6IHN0cmluZykge1xyXG4gICAgdmFyIGlzTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvKGlQYWQpfChpUGhvbmUpfChpUG9kKXwoYW5kcm9pZCl8KHdlYk9TKS9pKVxyXG4gICAgcmV0dXJuIGlzTW9iaWxlID8gJzkwJScgOiBkZWZhdWx0VmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBDdXN0b21FbmNvZGVyIGltcGxlbWVudHMgSHR0cFBhcmFtZXRlckNvZGVjIHtcclxuICAgIGVuY29kZUtleShrZXk6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGVuY29kZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlY29kZUtleShrZXk6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlY29kZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgfVxyXG59Il19