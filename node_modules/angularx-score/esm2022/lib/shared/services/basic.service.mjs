import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { throwError } from 'rxjs';
import { catchError, tap } from 'rxjs/operators';
import { HelperService } from './helper.service';
import { CommonUtils } from './common-utils.service';
import * as i0 from "@angular/core";
export class BaseService {
    constructor(injector, baseUrl, baseObject) {
        this.injector = injector;
        this.baseUrl = baseUrl;
        this.baseObject = baseObject;
        this.httpClient = this.injector.get(HttpClient);
        this.helperService = this.injector.get(HelperService);
        this.commonUtil = this.injector.get(CommonUtils);
    }
    // tslint:disable-next-line: ban-types
    getBaseUrl() {
        return this.baseUrl;
    }
    search(data, event) {
        const searchData = this.commonUtil.convertData(data);
        if (event) {
            searchData._search = event;
        }
        const buildParams = this.commonUtil.buildParams(searchData);
        const url = `${this.baseUrl}/search?`;
        return this.getRequest(url, { params: buildParams });
    }
    getConfigSearch() {
        const url = `http://localhost:8685/v1/config-search/${this.baseObject}`;
        return this.getRequest(url);
    }
    /**
     * findAll
     */
    findAll() {
        const url = `${this.baseUrl}`;
        return this.getRequest(url);
    }
    /**
     * findAllByFillter
     */
    findAllByFillter(data) {
        const url = `${this.baseUrl}/filter`;
        return this.postRequestNoToast(url, this.commonUtil.convertData(data || {}));
    }
    /**
     * findAllByFillterAndGroupCode
     */
    findAllByFillterAndGroupCode(data, groupCode) {
        const url = `${this.baseUrl}/filter/${groupCode}`;
        return this.postRequestNoToast(url, this.commonUtil.convertData(data || {}));
    }
    /**
     * findOne
     * param id
     */
    findOne(id) {
        const url = `${this.baseUrl}/${id}`;
        return this.getRequest(url);
    }
    /**
     * saveOrUpdate
     */
    saveOrUpdate(item) {
        const url = `${this.baseUrl}`;
        return this.postRequest(url, this.commonUtil.convertData(item));
    }
    /**
     * saveOrUpdate
     */
    saveOrUpdateConfigSearch(item) {
        const url = `http://localhost:8685/v1/config-search/save-config`;
        return this.postRequestNoneProcessing(url, this.commonUtil.convertData(item));
    }
    /**
     * saveOrUpdateFormFile
     */
    saveOrUpdateFormFile(item) {
        const formdata = this.commonUtil.convertFormFile(item);
        const url = `${this.baseUrl}/form-data`;
        return this.postRequest(url, formdata);
    }
    /**
     * deleteById
     * param id
     */
    deleteById(id) {
        const url = `${this.baseUrl}/${id}`;
        return this.deleteRequest(url);
    }
    /**
     * deleteByListId
     * param id
     */
    deleteItemsSelected(data) {
        const url = `${this.baseUrl}/delete-all`;
        return this.postRequest(url, this.commonUtil.convertData(data));
    }
    /*******************************/
    /**
     * make get request
     */
    getRequest(url, options) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.get(url, options)
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            // if (error.status !== 401 && error.status !== 403) {
            this.commonUtil.toastMessage('error', 'common.toast.haveError');
            // }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    /**
     * make post request
     */
    postRequest(url, data) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.post(url, data)
            .pipe(tap(// Log the result or error
        (res) => {
            if (res.type === 'WARNING') {
                this.commonUtil.toastMessage('warn', res.code, res.data);
            }
            else {
                this.commonUtil.toastMessage('success', res.code);
            }
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    postRequestNoToast(url, data) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.post(url, data)
            .pipe(tap(// Log the result or error
        (res) => {
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    /**
     * make post request for file
     */
    postRequestFile(url, data) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.post(url, data, { responseType: 'blob' })
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    /**
     * make get request
     */
    deleteRequest(url) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.delete(url)
            .pipe(tap(// Log the result or error
        (res) => {
            if (res.type === 'WARN') {
                this.commonUtil.toastMessage('warn', res.code, res.data);
            }
            else if (res.type === 'SUCSSES') {
                this.commonUtil.toastMessage('success', res.code);
            }
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    /**
     * getRequestNoneProcessing
     */
    getRequestNoneProcessing(url, options) {
        return this.httpClient.get(url, options)
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
        }), catchError(this.handleError));
    }
    /**
     * postRequestNoneProcessing
     */
    postRequestNoneProcessing(url, data) {
        return this.httpClient.post(url, data)
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
        }), catchError(this.handleError));
    }
    /**
     * postRequestFileNoneProcessing
     */
    postRequestFileNoneProcessing(url, data) {
        this.helperService.PROCESS_LOADER.next(true);
        return this.httpClient.post(url, data, { responseType: 'blob' })
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    /**
     * deleteRequestNoneProcessing
     */
    deleteRequestNoneProcessing(url) {
        return this.httpClient.delete(url)
            .pipe(tap(// Log the result or error
        // Log the result or error
        res => {
            // this.helperService.MESSAGE_TOASTER.next(res);
            this.helperService.PROCESS_LOADER.next(false);
        }, error => {
            if (error.status !== 401 && error.status !== 403) {
                this.commonUtil.toastMessage('error', 'common.toast.haveError');
            }
            this.helperService.PROCESS_LOADER.next(false);
        }), catchError(this.handleError));
    }
    // tslint:disable-next-line: typedef
    handleError(error) {
        const errorMsg = (error.message) ? error.message :
            error.status ? `${error.status} - ${error.statusText}` : 'Server error';
        return throwError(errorMsg);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: BaseService, deps: [{ token: i0.Injector }, { token: String }, { token: String }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: BaseService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.5", ngImport: i0, type: BaseService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i0.Injector }, { type: String }, { type: String }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXJ4LXNjb3JlL3NyYy9saWIvc2hhcmVkL3NlcnZpY2VzL2Jhc2ljLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBb0IsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLFVBQVUsRUFBYyxNQUFNLHNCQUFzQixDQUFDO0FBQzlELE9BQU8sRUFBa0IsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7QUFJckQsTUFBTSxPQUFPLFdBQVc7SUFNdEIsWUFBbUIsUUFBa0IsRUFDekIsT0FBZSxFQUNmLFVBQWtCO1FBRlgsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUluQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsc0NBQXNDO0lBQy9CLFVBQVU7UUFDZixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDdEIsQ0FBQztJQUVNLE1BQU0sQ0FB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QUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxFQUNELEtBQUssQ0FBQyxFQUFFO1lBQ04sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLEdBQUcsRUFBRTtnQkFDaEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLHdCQUF3QixDQUFDLENBQUM7YUFDakU7WUFDRCxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUNGLEVBQ0QsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FDN0IsQ0FBQztJQUNOLENBQUM7SUFFRCxvQ0FBb0M7SUFDNUIsV0FBVyxDQUFDLEtBQVU7UUFDNUIsTUFBTSxRQUFRLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5QyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLE1BQU0sS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7UUFDNUUsT0FBTyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUIsQ0FBQzs4R0FoVVUsV0FBVztrSEFBWCxXQUFXOzsyRkFBWCxXQUFXO2tCQUR2QixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBjYXRjaEVycm9yLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEhlbHBlclNlcnZpY2UgfSBmcm9tICcuL2hlbHBlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICcuL2NvbW1vbi11dGlscy5zZXJ2aWNlJztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCYXNlU2VydmljZSB7XHJcbiAgcHJvdGVjdGVkIGJhc2VVcmw6IFN0cmluZztcclxuICBwcm90ZWN0ZWQgaHR0cENsaWVudCE6IEh0dHBDbGllbnQ7XHJcbiAgcHVibGljIGhlbHBlclNlcnZpY2UhOiBIZWxwZXJTZXJ2aWNlO1xyXG4gIHB1YmxpYyBjb21tb25VdGlsITogQ29tbW9uVXRpbHM7XHJcbiAgcHVibGljIGJhc2VPYmplY3QhOiBTdHJpbmc7XHJcbiAgY29uc3RydWN0b3IocHVibGljIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICAgICAgICBiYXNlVXJsOiBTdHJpbmcsXHJcbiAgICAgICAgICAgICAgYmFzZU9iamVjdDogU3RyaW5nXHJcbiAgICApIHtcclxuICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLmJhc2VPYmplY3QgPSBiYXNlT2JqZWN0O1xyXG4gICAgdGhpcy5odHRwQ2xpZW50ID0gdGhpcy5pbmplY3Rvci5nZXQoSHR0cENsaWVudCk7XHJcbiAgICB0aGlzLmhlbHBlclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChIZWxwZXJTZXJ2aWNlKTtcclxuICAgIHRoaXMuY29tbW9uVXRpbCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbW1vblV0aWxzKTtcclxuICB9XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogYmFuLXR5cGVzXHJcbiAgcHVibGljIGdldEJhc2VVcmwoKTogU3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmJhc2VVcmw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VhcmNoKGRhdGE/OiBhbnksIGV2ZW50PzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHNlYXJjaERhdGEgPSB0aGlzLmNvbW1vblV0aWwuY29udmVydERhdGEoZGF0YSk7XHJcbiAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgc2VhcmNoRGF0YS5fc2VhcmNoID0gZXZlbnQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBidWlsZFBhcmFtcyA9IHRoaXMuY29tbW9uVXRpbC5idWlsZFBhcmFtcyhzZWFyY2hEYXRhKTtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vc2VhcmNoP2A7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRSZXF1ZXN0KHVybCwge3BhcmFtczogYnVpbGRQYXJhbXN9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb25maWdTZWFyY2goKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0Ojg2ODUvdjEvY29uZmlnLXNlYXJjaC8ke3RoaXMuYmFzZU9iamVjdH1gO1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0UmVxdWVzdCh1cmwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZmluZEFsbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kQWxsKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9YDtcclxuICAgIHJldHVybiB0aGlzLmdldFJlcXVlc3QodXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGZpbmRBbGxCeUZpbGx0ZXJcclxuICAgKi9cclxuICBwdWJsaWMgZmluZEFsbEJ5RmlsbHRlcihkYXRhPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vZmlsdGVyYDtcclxuICAgIHJldHVybiB0aGlzLnBvc3RSZXF1ZXN0Tm9Ub2FzdCh1cmwsIHRoaXMuY29tbW9uVXRpbC5jb252ZXJ0RGF0YShkYXRhIHx8IHt9KSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBmaW5kQWxsQnlGaWxsdGVyQW5kR3JvdXBDb2RlXHJcbiAgICovXHJcbiAgcHVibGljIGZpbmRBbGxCeUZpbGx0ZXJBbmRHcm91cENvZGUoZGF0YTogYW55LCBncm91cENvZGU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2ZpbHRlci8ke2dyb3VwQ29kZX1gO1xyXG4gICAgcmV0dXJuIHRoaXMucG9zdFJlcXVlc3ROb1RvYXN0KHVybCwgdGhpcy5jb21tb25VdGlsLmNvbnZlcnREYXRhKGRhdGEgfHwge30pKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGZpbmRPbmVcclxuICAgKiBwYXJhbSBpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kT25lKGlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS8ke2lkfWA7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRSZXF1ZXN0KHVybCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIHNhdmVPclVwZGF0ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzYXZlT3JVcGRhdGUoaXRlbTogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH1gO1xyXG4gICAgcmV0dXJuIHRoaXMucG9zdFJlcXVlc3QodXJsLCB0aGlzLmNvbW1vblV0aWwuY29udmVydERhdGEoaXRlbSkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2F2ZU9yVXBkYXRlXHJcbiAgICovXHJcbiAgIHB1YmxpYyBzYXZlT3JVcGRhdGVDb25maWdTZWFyY2goaXRlbTogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0Ojg2ODUvdjEvY29uZmlnLXNlYXJjaC9zYXZlLWNvbmZpZ2A7XHJcbiAgICByZXR1cm4gdGhpcy5wb3N0UmVxdWVzdE5vbmVQcm9jZXNzaW5nKHVybCwgdGhpcy5jb21tb25VdGlsLmNvbnZlcnREYXRhKGl0ZW0pKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNhdmVPclVwZGF0ZUZvcm1GaWxlXHJcbiAgICovXHJcbiAgcHVibGljIHNhdmVPclVwZGF0ZUZvcm1GaWxlKGl0ZW06IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBmb3JtZGF0YSA9IHRoaXMuY29tbW9uVXRpbC5jb252ZXJ0Rm9ybUZpbGUoaXRlbSk7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2Zvcm0tZGF0YWA7XHJcbiAgICByZXR1cm4gdGhpcy5wb3N0UmVxdWVzdCh1cmwsIGZvcm1kYXRhKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogZGVsZXRlQnlJZFxyXG4gICAqIHBhcmFtIGlkXHJcbiAgICovXHJcbiAgcHVibGljIGRlbGV0ZUJ5SWQoaWQ6IG51bWJlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9LyR7aWR9YDtcclxuICAgIHJldHVybiB0aGlzLmRlbGV0ZVJlcXVlc3QodXJsKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGRlbGV0ZUJ5TGlzdElkXHJcbiAgICogcGFyYW0gaWRcclxuICAgKi9cclxuICAgICBwdWJsaWMgZGVsZXRlSXRlbXNTZWxlY3RlZChkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2RlbGV0ZS1hbGxgO1xyXG4gICAgICByZXR1cm4gdGhpcy5wb3N0UmVxdWVzdCh1cmwsIHRoaXMuY29tbW9uVXRpbC5jb252ZXJ0RGF0YShkYXRhKSk7XHJcbiAgICB9XHJcbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG4gIC8qKlxyXG4gICAqIG1ha2UgZ2V0IHJlcXVlc3RcclxuICAgKi9cclxuICAgcHJvdGVjdGVkIGdldFJlcXVlc3QodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQodHJ1ZSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh1cmwsIG9wdGlvbnMpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcCggLy8gTG9nIHRoZSByZXN1bHQgb3IgZXJyb3JcclxuICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaGVscGVyU2VydmljZS5NRVNTQUdFX1RPQVNURVIubmV4dChyZXMpO1xyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAvLyBpZiAoZXJyb3Iuc3RhdHVzICE9PSA0MDEgJiYgZXJyb3Iuc3RhdHVzICE9PSA0MDMpIHtcclxuICAgICAgICAgICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCdlcnJvcicsICdjb21tb24udG9hc3QuaGF2ZUVycm9yJyk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxyXG4gICAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBtYWtlIHBvc3QgcmVxdWVzdFxyXG4gICAqL1xyXG4gICBwcm90ZWN0ZWQgcG9zdFJlcXVlc3QodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQodHJ1ZSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAoIC8vIExvZyB0aGUgcmVzdWx0IG9yIGVycm9yXHJcbiAgICAgICAgICAocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy50eXBlID09PSAnV0FSTklORycpIHtcclxuICAgICAgICAgICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCd3YXJuJywgcmVzLmNvZGUsIHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCdzdWNjZXNzJywgcmVzLmNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDQwMSAmJiBlcnJvci5zdGF0dXMgIT09IDQwMykge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgcG9zdFJlcXVlc3ROb1RvYXN0KHVybDogc3RyaW5nLCBkYXRhPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KHRydWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKCAvLyBMb2cgdGhlIHJlc3VsdCBvciBlcnJvclxyXG4gICAgICAgICAgKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDQwMSAmJiBlcnJvci5zdGF0dXMgIT09IDQwMykge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBtYWtlIHBvc3QgcmVxdWVzdCBmb3IgZmlsZVxyXG4gICAqL1xyXG4gICBwcm90ZWN0ZWQgcG9zdFJlcXVlc3RGaWxlKHVybDogc3RyaW5nLCBkYXRhPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KHRydWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZGF0YSwge3Jlc3BvbnNlVHlwZTogJ2Jsb2InfSlcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKCAvLyBMb2cgdGhlIHJlc3VsdCBvciBlcnJvclxyXG4gICAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgICAgLy8gdGhpcy5oZWxwZXJTZXJ2aWNlLk1FU1NBR0VfVE9BU1RFUi5uZXh0KHJlcyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDQwMSAmJiBlcnJvci5zdGF0dXMgIT09IDQwMykge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBtYWtlIGdldCByZXF1ZXN0XHJcbiAgICovXHJcbiAgIHByb3RlY3RlZCBkZWxldGVSZXF1ZXN0KHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KHRydWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5kZWxldGUodXJsKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAoIC8vIExvZyB0aGUgcmVzdWx0IG9yIGVycm9yXHJcbiAgICAgICAgICAocmVzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy50eXBlID09PSAnV0FSTicpIHtcclxuICAgICAgICAgICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCd3YXJuJywgcmVzLmNvZGUsIHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXMudHlwZSA9PT0gJ1NVQ1NTRVMnKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5jb21tb25VdGlsLnRvYXN0TWVzc2FnZSgnc3VjY2VzcycsIHJlcy5jb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzICE9PSA0MDEgJiYgZXJyb3Iuc3RhdHVzICE9PSA0MDMpIHtcclxuICAgICAgICAgICAgICB0aGlzLmNvbW1vblV0aWwudG9hc3RNZXNzYWdlKCdlcnJvcicsICdjb21tb24udG9hc3QuaGF2ZUVycm9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZ2V0UmVxdWVzdE5vbmVQcm9jZXNzaW5nXHJcbiAgICovXHJcbiAgIHByb3RlY3RlZCBnZXRSZXF1ZXN0Tm9uZVByb2Nlc3NpbmcodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodXJsLCBvcHRpb25zKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAoIC8vIExvZyB0aGUgcmVzdWx0IG9yIGVycm9yXHJcbiAgICAgICAgICByZXMgPT4ge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmhlbHBlclNlcnZpY2UuTUVTU0FHRV9UT0FTVEVSLm5leHQocmVzKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDQwMSAmJiBlcnJvci5zdGF0dXMgIT09IDQwMykge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHBvc3RSZXF1ZXN0Tm9uZVByb2Nlc3NpbmdcclxuICAgKi9cclxuICAgcHJvdGVjdGVkIHBvc3RSZXF1ZXN0Tm9uZVByb2Nlc3NpbmcodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZGF0YSlcclxuICAgIC5waXBlKFxyXG4gICAgICB0YXAoIC8vIExvZyB0aGUgcmVzdWx0IG9yIGVycm9yXHJcbiAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgIC8vIHRoaXMuaGVscGVyU2VydmljZS5NRVNTQUdFX1RPQVNURVIubmV4dChyZXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgaWYgKGVycm9yLnN0YXR1cyAhPT0gNDAxICYmIGVycm9yLnN0YXR1cyAhPT0gNDAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICksXHJcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5oYW5kbGVFcnJvcilcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBwb3N0UmVxdWVzdEZpbGVOb25lUHJvY2Vzc2luZ1xyXG4gICAqL1xyXG4gICBwcm90ZWN0ZWQgcG9zdFJlcXVlc3RGaWxlTm9uZVByb2Nlc3NpbmcodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQodHJ1ZSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBkYXRhLCB7cmVzcG9uc2VUeXBlOiAnYmxvYid9KVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAoIC8vIExvZyB0aGUgcmVzdWx0IG9yIGVycm9yXHJcbiAgICAgICAgICByZXMgPT4ge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmhlbHBlclNlcnZpY2UuTUVTU0FHRV9UT0FTVEVSLm5leHQocmVzKTtcclxuICAgICAgICAgICAgdGhpcy5oZWxwZXJTZXJ2aWNlLlBST0NFU1NfTE9BREVSLm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yLnN0YXR1cyAhPT0gNDAxICYmIGVycm9yLnN0YXR1cyAhPT0gNDAzKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5jb21tb25VdGlsLnRvYXN0TWVzc2FnZSgnZXJyb3InLCAnY29tbW9uLnRvYXN0LmhhdmVFcnJvcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICApLFxyXG4gICAgICAgIGNhdGNoRXJyb3IodGhpcy5oYW5kbGVFcnJvcilcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGRlbGV0ZVJlcXVlc3ROb25lUHJvY2Vzc2luZ1xyXG4gICAqL1xyXG4gICBwcm90ZWN0ZWQgZGVsZXRlUmVxdWVzdE5vbmVQcm9jZXNzaW5nKHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZGVsZXRlKHVybClcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKCAvLyBMb2cgdGhlIHJlc3VsdCBvciBlcnJvclxyXG4gICAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgICAgLy8gdGhpcy5oZWxwZXJTZXJ2aWNlLk1FU1NBR0VfVE9BU1RFUi5uZXh0KHJlcyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGVscGVyU2VydmljZS5QUk9DRVNTX0xPQURFUi5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDQwMSAmJiBlcnJvci5zdGF0dXMgIT09IDQwMykge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbC50b2FzdE1lc3NhZ2UoJ2Vycm9yJywgJ2NvbW1vbi50b2FzdC5oYXZlRXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhlbHBlclNlcnZpY2UuUFJPQ0VTU19MT0FERVIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKSxcclxuICAgICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHR5cGVkZWZcclxuICBwcml2YXRlIGhhbmRsZUVycm9yKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnN0IGVycm9yTXNnID0gKGVycm9yLm1lc3NhZ2UpID8gZXJyb3IubWVzc2FnZSA6XHJcbiAgICAgICAgZXJyb3Iuc3RhdHVzID8gYCR7ZXJyb3Iuc3RhdHVzfSAtICR7ZXJyb3Iuc3RhdHVzVGV4dH1gIDogJ1NlcnZlciBlcnJvcic7XHJcbiAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvck1zZyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==